(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{344:function(s,t,a){s.exports=a.p+"assets/img/image-20200406184656917.26e2021c.png"},499:function(s,t,a){s.exports=a.p+"assets/img/image-20200505183738289.286028b5.png"},500:function(s,t,a){s.exports=a.p+"assets/img/image-20200524150339551.f07ce7bd.png"},501:function(s,t,a){s.exports=a.p+"assets/img/image-20200406232838722.96750940.png"},502:function(s,t,a){s.exports=a.p+"assets/img/image-20200526203726071.8d0d7d59.png"},503:function(s,t,a){s.exports=a.p+"assets/img/image-20200403224313355.32c98063.png"},504:function(s,t,a){s.exports=a.p+"assets/img/image-20200404094800622.cebaa87a.png"},505:function(s,t,a){s.exports=a.p+"assets/img/image-20200505213817934.1a69bd43.png"},506:function(s,t,a){s.exports=a.p+"assets/img/image-20200505214156148.a9b7ce7d.png"},507:function(s,t,a){s.exports=a.p+"assets/img/image-20200405142656921.c6f3fe1f.png"},655:function(s,t,a){"use strict";a.r(t);var e=a(3),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[t("strong",[s._v("Kubernetes")]),s._v("是一个开源的，用于管理云平台中多个主机上的容器化的应用，"),t("strong",[s._v("Kubernetes")]),s._v("的目标是让部署容器化的应用简单并且高效（powerful）,Kubernetes提供了应用部署，规划，更新，维护的一种机制。根据"),t("a",{attrs:{href:"https://www.bilibili.com/video/BV1cK4y1L7Am?p=1",target:"_blank",rel:"noopener noreferrer"}},[s._v("哔哩哔哩黑马视频"),t("OutboundLink")],1),s._v("学习，学习来源于搬迁，部分文档有根据自己学习进行修改和补充，"),t("a",{attrs:{href:"https://www.orchome.com/1786",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档学习资源"),t("OutboundLink")],1)])]),s._v(" "),t("h1",{attrs:{id:"第一章-kubernetes介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一章-kubernetes介绍"}},[s._v("#")]),s._v(" 第一章 kubernetes介绍")]),s._v(" "),t("p",[s._v("本章节主要介绍应用程序在服务器上部署方式演变以及kubernetes的概念、组件和工作原理。")]),s._v(" "),t("h2",{attrs:{id:"应用部署方式演变"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用部署方式演变"}},[s._v("#")]),s._v(" 应用部署方式演变")]),s._v(" "),t("p",[s._v("在部署应用程序的方式上，主要经历了三个时代：")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("传统部署")]),s._v("：互联网早期，会直接将应用程序部署在物理机上")]),s._v(" "),t("blockquote",[t("p",[s._v("优点：简单，不需要其它技术的参与")]),s._v(" "),t("p",[s._v("缺点：不能为应用程序定义资源使用边界，很难合理地分配计算资源，而且程序之间容易产生影响")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("虚拟化部署")]),s._v("：可以在一台物理机上运行多个虚拟机，每个虚拟机都是独立的一个环境")]),s._v(" "),t("blockquote",[t("p",[s._v("优点：程序环境不会相互产生影响，提供了一定程度的安全性")]),s._v(" "),t("p",[s._v("缺点：增加了操作系统，浪费了部分资源")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("容器化部署")]),s._v("：与虚拟化类似，但是共享了操作系统")]),s._v(" "),t("blockquote",[t("p",[s._v("优点：")]),s._v(" "),t("p",[s._v("​    可以保证每个容器拥有自己的文件系统、CPU、内存、进程空间等")]),s._v(" "),t("p",[s._v("​    运行应用程序所需要的资源都被容器包装，并和底层基础架构解耦")]),s._v(" "),t("p",[s._v("​    容器化的应用程序可以跨云服务商、跨Linux操作系统发行版进行部署")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:a(499),alt:"image-20200505183738289"}})]),s._v(" "),t("p",[s._v("容器化部署方式给带来很多的便利，但是也会出现一些问题，比如说：")]),s._v(" "),t("ul",[t("li",[s._v("一个容器故障停机了，怎么样让另外一个容器立刻启动去替补停机的容器")]),s._v(" "),t("li",[s._v("当并发访问量变大的时候，怎么样做到横向扩展容器数量")])]),s._v(" "),t("p",[s._v("这些容器管理的问题统称为"),t("strong",[s._v("容器编排")]),s._v("问题，为了解决这些容器编排问题，就产生了一些容器编排的软件：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Swarm")]),s._v("：Docker自己的容器编排工具")]),s._v(" "),t("li",[t("strong",[s._v("Mesos")]),s._v("：Apache的一个资源统一管控的工具，需要和Marathon结合使用")]),s._v(" "),t("li",[t("strong",[s._v("Kubernetes")]),s._v("：Google开源的的容器编排工具")])]),s._v(" "),t("img",{staticStyle:{border:"1px solid",zoom:"110%"},attrs:{src:a(500),alt:"image-20200524150339551"}}),s._v(" "),t("h2",{attrs:{id:"kubernetes简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes简介"}},[s._v("#")]),s._v(" kubernetes简介")]),s._v(" "),t("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:a(501),alt:"image-20200406232838722"}}),s._v(" "),t("p",[s._v("​")]),s._v(" "),t("p",[s._v("​    kubernetes，是一个全新的基于容器技术的分布式架构领先方案，是谷歌严格保密十几年的秘密武器----Borg系统的一个开源版本，于2014年9月发布第一个版本，2015年7月发布第一个正式版本。")]),s._v(" "),t("p",[s._v("​    kubernetes的本质是"),t("strong",[s._v("一组服务器集群")]),s._v("，它可以在集群的每个节点上运行特定的程序，来对节点中的容器进行管理。目的是实现资源管理的自动化，主要提供了如下的主要功能：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("自我修复")]),s._v("：一旦某一个容器崩溃，能够在1秒中左右迅速启动新的容器")]),s._v(" "),t("li",[t("strong",[s._v("弹性伸缩")]),s._v("：可以根据需要，自动对集群中正在运行的容器数量进行调整")]),s._v(" "),t("li",[t("strong",[s._v("服务发现")]),s._v("：服务可以通过自动发现的形式找到它所依赖的服务")]),s._v(" "),t("li",[t("strong",[s._v("负载均衡")]),s._v("：如果一个服务起动了多个容器，能够自动实现请求的负载均衡")]),s._v(" "),t("li",[t("strong",[s._v("版本回退")]),s._v("：如果发现新发布的程序版本有问题，可以立即回退到原来的版本")]),s._v(" "),t("li",[t("strong",[s._v("存储编排")]),s._v("：可以根据容器自身的需求自动创建存储卷")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(502),alt:"image-20200526203726071"}})]),s._v(" "),t("h2",{attrs:{id:"kubernetes组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes组件"}},[s._v("#")]),s._v(" kubernetes组件")]),s._v(" "),t("p",[s._v("一个kubernetes集群主要是由"),t("strong",[s._v("控制节点(master)")]),s._v("、**工作节点(node)**构成，每个节点上都会安装不同的组件。")]),s._v(" "),t("p",[t("strong",[s._v("master：集群的控制平面，负责集群的决策  (  管理  )")])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("ApiServer")]),s._v(" : 资源操作的唯一入口，接收用户输入的命令，提供认证、授权、API注册和发现等机制")]),s._v(" "),t("p",[t("strong",[s._v("Scheduler")]),s._v(" : 负责集群资源调度，按照预定的调度策略将Pod调度到相应的node节点上")]),s._v(" "),t("p",[t("strong",[s._v("ControllerManager")]),s._v(" : 负责维护集群的状态，比如程序部署安排、故障检测、自动扩展、滚动更新等")]),s._v(" "),t("p",[s._v("**Etcd **：负责存储集群中各种资源对象的信息")])]),s._v(" "),t("p",[s._v("**node：集群的数据平面，负责为容器提供运行环境 ( 干活 ) **")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Kubelet")]),s._v(" : 负责维护容器的生命周期，即通过控制docker，来创建、更新、销毁容器")]),s._v(" "),t("p",[t("strong",[s._v("KubeProxy")]),s._v(" : 负责提供集群内部的服务发现和负载均衡")]),s._v(" "),t("p",[t("strong",[s._v("Docker")]),s._v(" : 负责节点上容器的各种操作")])]),s._v(" "),t("img",{staticStyle:{zoom:"200%"},attrs:{src:a(344),alt:"image-20200406184656917"}}),s._v(" "),t("p",[s._v("下面，以部署一个nginx服务来说明kubernetes系统各个组件调用关系：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("首先要明确，一旦kubernetes环境启动之后，master和node都会将自身的信息存储到etcd数据库中")])]),s._v(" "),t("li",[t("p",[s._v("一个nginx服务的安装请求会首先被发送到master节点的apiServer组件")])]),s._v(" "),t("li",[t("p",[s._v("apiServer组件会调用scheduler组件来决定到底应该把这个服务安装到哪个node节点上")]),s._v(" "),t("p",[s._v("在此时，它会从etcd中读取各个node节点的信息，然后按照一定的算法进行选择，并将结果告知apiServer")])]),s._v(" "),t("li",[t("p",[s._v("apiServer调用controller-manager去调度Node节点安装nginx服务")])]),s._v(" "),t("li",[t("p",[s._v("kubelet接收到指令后，会通知docker，然后由docker来启动一个nginx的pod")]),s._v(" "),t("p",[s._v("pod是kubernetes的最小操作单元，容器必须跑在pod中至此，")])]),s._v(" "),t("li",[t("p",[s._v("一个nginx服务就运行了，如果需要访问nginx，就需要通过kube-proxy来对pod产生访问的代理")])])]),s._v(" "),t("p",[s._v("​        这样，外界用户就可以访问集群中的nginx服务了")]),s._v(" "),t("h2",{attrs:{id:"kubernetes概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes概念"}},[s._v("#")]),s._v(" kubernetes概念")]),s._v(" "),t("p",[t("strong",[s._v("Master")]),s._v("：集群控制节点，每个集群需要至少一个master节点负责集群的管控")]),s._v(" "),t("p",[t("strong",[s._v("Node")]),s._v("：工作负载节点，由master分配容器到这些node工作节点上，然后node节点上的docker负责容器的运行")]),s._v(" "),t("p",[t("strong",[s._v("Pod")]),s._v("：kubernetes的最小控制单元，容器都是运行在pod中的，一个pod中可以有1个或者多个容器")]),s._v(" "),t("p",[t("strong",[s._v("Controller")]),s._v("：控制器，通过它来实现对pod的管理，比如启动pod、停止pod、伸缩pod的数量等等")]),s._v(" "),t("p",[t("strong",[s._v("Service")]),s._v("：pod对外服务的统一入口，下面可以维护者同一类的多个pod")]),s._v(" "),t("p",[t("strong",[s._v("Label")]),s._v("：标签，用于对pod进行分类，同一类pod会拥有相同的标签")]),s._v(" "),t("p",[t("strong",[s._v("NameSpace")]),s._v("：命名空间，用来隔离pod的运行环境")]),s._v(" "),t("img",{staticStyle:{zoom:"200%"},attrs:{src:a(503),alt:"image-20200403224313355"}}),s._v(" "),t("h1",{attrs:{id:"第二章-集群环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二章-集群环境搭建"}},[s._v("#")]),s._v(" 第二章 集群环境搭建")]),s._v(" "),t("p",[s._v("本章节主要介绍如何搭建kubernetes的集群环境")]),s._v(" "),t("h2",{attrs:{id:"环境规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境规划"}},[s._v("#")]),s._v(" 环境规划")]),s._v(" "),t("h3",{attrs:{id:"集群类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群类型"}},[s._v("#")]),s._v(" 集群类型")]),s._v(" "),t("p",[s._v("kubernetes集群大体上分为两类："),t("strong",[s._v("一主多从")]),s._v("和"),t("strong",[s._v("多主多从")]),s._v("。")]),s._v(" "),t("ul",[t("li",[s._v("一主多从：一台Master节点和多台Node节点，搭建简单，但是有单机故障风险，适合用于测试环境")]),s._v(" "),t("li",[s._v("多主多从：多台Master节点和多台Node节点，搭建麻烦，安全性高，适合用于生产环境")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(504),alt:"image-20200404094800622"}})]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("说明：为了测试简单，本次搭建的是 一主两从 类型的集群")])])]),s._v(" "),t("h3",{attrs:{id:"安装方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装方式"}},[s._v("#")]),s._v(" 安装方式")]),s._v(" "),t("p",[s._v("kubernetes有多种部署方式，目前主流的方式有kubeadm、minikube、二进制包")]),s._v(" "),t("ul",[t("li",[s._v("minikube：一个用于快速搭建单节点kubernetes的工具")]),s._v(" "),t("li",[s._v("kubeadm：一个用于快速搭建kubernetes集群的工具")]),s._v(" "),t("li",[s._v("二进制包 ：从官网下载每个组件的二进制包，依次去安装，此方式对于理解kubernetes组件更加有效")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("说明：现在需要安装kubernetes的集群环境，但是又不想过于麻烦，所以选择使用kubeadm方式")])])]),s._v(" "),t("h3",{attrs:{id:"主机规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机规划"}},[s._v("#")]),s._v(" 主机规划")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("作用")]),s._v(" "),t("th",[s._v("IP地址")]),s._v(" "),t("th",[s._v("操作系统")]),s._v(" "),t("th",[s._v("配置")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Master")]),s._v(" "),t("td",[s._v("192.168.109.100")]),s._v(" "),t("td",[s._v("Centos7.5    基础设施服务器")]),s._v(" "),t("td",[s._v("2颗CPU  2G内存   50G硬盘")])]),s._v(" "),t("tr",[t("td",[s._v("Node1")]),s._v(" "),t("td",[s._v("192.168.109.101")]),s._v(" "),t("td",[s._v("Centos7.5    基础设施服务器")]),s._v(" "),t("td",[s._v("2颗CPU  2G内存   50G硬盘")])]),s._v(" "),t("tr",[t("td",[s._v("Node2")]),s._v(" "),t("td",[s._v("192.168.109.102")]),s._v(" "),t("td",[s._v("Centos7.5    基础设施服务器")]),s._v(" "),t("td",[s._v("2颗CPU  2G内存   50G硬盘")])])])]),s._v(" "),t("h2",{attrs:{id:"环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),t("p",[s._v("​    本次环境搭建需要安装三台Centos服务器（一主二从），然后在每台服务器中分别安装docker（18.06.3），kubeadm（1.17.4）、kubelet（1.17.4）、kubectl（1.17.4）程序。")]),s._v(" "),t("h3",{attrs:{id:"主机安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机安装"}},[s._v("#")]),s._v(" 主机安装")]),s._v(" "),t("p",[s._v("安装虚拟机过程中注意下面选项的设置：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("操作系统环境：CPU（2C）    内存（2G）   硬盘（50G）")])]),s._v(" "),t("li",[t("p",[s._v("语言选择：中文简体")])]),s._v(" "),t("li",[t("p",[s._v("软件选择：基础设施服务器")])]),s._v(" "),t("li",[t("p",[s._v("分区选择：自动分区")])]),s._v(" "),t("li",[t("p",[s._v("网络配置：按照下面配置网路地址信息")]),s._v(" "),t("div",{staticClass:"language-md line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-md"}},[t("code",[s._v("网络地址：192.168.109.100  （每台主机都不一样  分别为100、101、102）\n子网掩码：255.255.255.0\n默认网关：192.168.109.2\nDNS：    223.5.5.5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:a(505),alt:"image-20200505213817934"}})])]),s._v(" "),t("li",[t("p",[s._v("主机名设置：按照下面信息设置主机名")]),s._v(" "),t("div",{staticClass:"language-md line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-md"}},[t("code",[s._v("master节点： master\nnode节点：   node1\nnode节点：   node2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:a(506),alt:"image-20200505214156148"}})])])]),s._v(" "),t("h3",{attrs:{id:"环境初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境初始化"}},[s._v("#")]),s._v(" 环境初始化")]),s._v(" "),t("ol",[t("li",[s._v("检查操作系统的版本")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此方式下安装kubernetes集群要求Centos版本要在7.5或之上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release")]),s._v("\nCentOS Linux release 7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1804 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("2） 主机名解析")]),s._v(" "),t("p",[s._v("为了方便后面集群节点间的直接调用，在这配置一下主机名解析，企业中推荐使用内部DNS服务器")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机名成解析 编辑三台服务器的/etc/hosts文件，添加下面内容")]),s._v("\n192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100  master\n192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("101  node1\n192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("102  node2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("3） 时间同步")]),s._v(" "),t("p",[s._v("kubernetes要求集群中的节点时间必须精确一致，这里直接使用chronyd服务从网络同步时间。")]),s._v(" "),t("p",[s._v("企业中建议配置内部的时间同步服务器")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动chronyd服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start chronyd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置chronyd服务开机自启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable chronyd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chronyd服务启动稍等几秒钟，就可以使用date命令验证时间了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# date")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("4） 禁用iptables和firewalld服务")]),s._v(" "),t("p",[s._v("kubernetes和docker在运行中会产生大量的iptables规则，为了不让系统规则跟它们混淆，直接关闭系统的规则")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 关闭firewalld服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop firewalld")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable firewalld")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 关闭iptables服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop iptables")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable iptables")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("5） 禁用selinux")]),s._v(" "),t("p",[s._v("selinux是linux系统下的一个安全服务，如果不关闭它，在安装集群中会产生各种各样的奇葩问题")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 /etc/selinux/config 文件，修改SELINUX的值为disabled")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\nSELINUX=disabled\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("6） 禁用swap分区")]),s._v(" "),t("p",[s._v("swap分区指的是虚拟内存分区，它的作用是在物理内存使用完之后，将磁盘空间虚拟成内存来使用")]),s._v(" "),t("p",[s._v("启用swap设备会对系统的性能产生非常负面的影响，因此kubernetes要求每个节点都要禁用swap设备")]),s._v(" "),t("p",[s._v("但是如果因为某些原因确实不能关闭swap分区，就需要在集群安装过程中通过明确的参数进行配置说明")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑分区配置文件/etc/fstab，注释掉swap分区一行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\n UUID=455cc753-7a60-4c17-a424-7741728c44a1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("boot    xfs     defaults        0 0\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dev/mapper/centos-home "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home                      xfs     defaults        0 0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /dev/mapper/centos-swap swap                      swap    defaults        0 0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("7）修改linux的内核参数")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改linux的内核参数，添加网桥过滤和地址转发功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/sysctl.d/kubernetes.conf文件，添加如下配置:")]),s._v("\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge-nf-call-ip6tables = 1\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge-nf-call-iptables = 1\nnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_forward = 1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -p")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载网桥过滤模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modprobe br_netfilter")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看网桥过滤模块是否加载成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep br_netfilter")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("8）配置ipvs功能")]),s._v(" "),t("p",[s._v("在kubernetes中service有两种代理模型，一种是基于iptables的，一种是基于ipvs的")]),s._v(" "),t("p",[s._v("两者比较的话，ipvs的性能明显要高一些，但是如果要使用它，需要手动载入ipvs模块")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 安装ipset和ipvsadm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install ipset ipvsadmin -y")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 添加需要加载的模块写入脚本文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF >  /etc/sysconfig/modules/ipvs.modules")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\nmodprobe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs\nmodprobe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_rr\nmodprobe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_wrr\nmodprobe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_sh\nmodprobe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" nf_conntrack_ipv4\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 为脚本文件添加执行权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /etc/sysconfig/modules/ipvs.modules")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 执行脚本文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /bin/bash /etc/sysconfig/modules/ipvs.modules")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5 查看对应的模块是否加载成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep -e ip_vs -e nf_conntrack_ipv4")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("9） 重启服务器")]),s._v(" "),t("p",[s._v("上面步骤完成之后，需要重新启动linux系统")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reboot")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 切换镜像源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 查看当前镜像源中支持的docker版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum list docker-ce --showduplicates")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 安装特定版本的docker-ce")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须指定--setopt=obsoletes=0，否则yum会自动安装更高版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 添加一个配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker在默认情况下使用的Cgroup Driver为cgroupfs，而kubernetes推荐使用systemd来代替cgroupfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /etc/docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF >  /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://kn0t2bca.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5 启动docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable docker")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6 检查docker状态和版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker version")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"安装kubernetes组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装kubernetes组件"}},[s._v("#")]),s._v(" 安装kubernetes组件")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于kubernetes的镜像源在国外，速度比较慢，这里切换成国内的镜像源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/yum.repos.d/kubernetes.repo，添加下面的配置 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[kubernetes]")]),s._v("\nname=Kubernetes\nbaseurl=http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/kubernetes/yum/doc/yum-key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\n       http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/kubernetes/yum/doc/rpm-package-key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装kubeadm、kubelet和kubectl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置kubelet的cgroup")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/sysconfig/kubelet，添加下面的配置")]),s._v("\nKUBELET_CGROUP_ARGS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cgroup-driver=systemd"')]),s._v("\nKUBE_PROXY_MODE="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ipvs"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 设置kubelet开机自启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kubelet")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"准备集群镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备集群镜像"}},[s._v("#")]),s._v(" 准备集群镜像")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在安装kubernetes集群之前，必须要提前准备好集群需要的镜像，所需镜像可以通过下面命令查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm config images list")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此镜像在kubernetes的仓库中,由于网络原因,无法连接，下面提供了一种替代方案")]),s._v("\nimages="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    kube-apiserver:v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n    kube-controller-manager:v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n    kube-scheduler:v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n    kube-proxy:v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n    pause:3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1\n    etcd:3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("3-0\n    coredns:1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("5\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" imageName in $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n\tdocker pull registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn-hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/google_containers/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n\tdocker tag registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn-hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/google_containers/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" \t\tk8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gcr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n\tdocker rmi registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn-hangzhou"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com/google_containers/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\ndone\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"集群初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群初始化"}},[s._v("#")]),s._v(" 集群初始化")]),s._v(" "),t("p",[s._v("下面开始对集群进行初始化，并将node节点加入到集群中")]),s._v(" "),t("blockquote",[t("p",[s._v("下面的操作只需要在"),t("code",[s._v("master")]),s._v("节点上执行即可")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init \\")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubernetes-version=v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4 \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("pod-network-cidr=10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0/16 \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service-cidr=10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0/12 \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apiserver-advertise-address=192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建必要文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p $HOME/.kube")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo chown $(id -u):$(id -g) $HOME/.kube/config")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[s._v("下面的操作只需要在"),t("code",[s._v("node")]),s._v("节点上执行即可")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将node节点加入集群")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm join 192.168.10.100:6443 \\ ")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token 8507uc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("o0knircuri8etnw2 \\\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("discovery-token-ca-cert-hash \\\n\tsha256:acc37967fb5b0acf39d7598f8a439cc7dc88f439a3f4d0c9cae88e7901b9d3f\n\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群状态 此时的集群状态为NotReady，这是因为还没有配置网络插件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME     STATUS     ROLES    AGE     VERSION\nmaster   NotReady   master   6m43s   v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode1    NotReady   <none>   22s     v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode2    NotReady   <none>   19s     v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"安装网络插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装网络插件"}},[s._v("#")]),s._v(" 安装网络插件")]),s._v(" "),t("p",[s._v("kubernetes支持多种网络插件，比如flannel、calico、canal等等，任选一种使用即可，本次选择flannel")]),s._v(" "),t("blockquote",[t("p",[s._v("下面操作依旧只在"),t("code",[s._v("master")]),s._v("节点执行即可，插件使用的是DaemonSet的控制器，它会在每个节点上都运行")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取fannel的配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件中quay.io仓库为quay-mirror.qiniu.com")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用配置文件启动fannel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f kube-flannel.yml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 稍等片刻，再次查看集群节点的状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME     STATUS   ROLES    AGE     VERSION\nmaster   Ready    master   15m     v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode1    Ready    <none>   8m53s   v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode2    Ready    <none>   8m50s   v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("至此，kubernetes的集群环境搭建完成")]),s._v(" "),t("h2",{attrs:{id:"服务部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务部署"}},[s._v("#")]),s._v(" 服务部署")]),s._v(" "),t("p",[s._v("接下来在kubernetes集群中部署一个nginx程序，测试下集群是否在正常工作。")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment nginx --image=nginx:1.14-alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose deployment nginx --port=80 --type=NodePort")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods,service")]),s._v("\nNAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-86c57db685-fdc2k   1/1     Running   0          18m\n\nNAME                 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("        CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nservice/kubernetes   ClusterIP   10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1       <none>        443/TCP        82m\nservice/nginx        NodePort    10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("104"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("121"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("45   <none>        80:30073/TCP   17m\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 最后在电脑上访问下部署的nginx服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("img",{staticStyle:{zoom:"80%",border:"1px solid"},attrs:{src:a(507),alt:"image-20200405142656921"}}),s._v(" "),t("h2",{attrs:{id:"命令自动补全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令自动补全"}},[s._v("#")]),s._v(" 命令自动补全")]),s._v(" "),t("ul",[t("li",[s._v("k8s < 1.3版本")])]),s._v(" "),t("p",[s._v("可以通过如下命令："),t("code",[s._v("source ./contrib/completions/bash/kubectl")])]),s._v(" "),t("ul",[t("li",[s._v("k8s >= 1.3 版本")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" bash-completion\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /usr/share/bash-completion/bash_completion\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubectl completion "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source <(kubectl completion bash)"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);