(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{615:function(s,a,t){s.exports=t.p+"assets/img/image-20200413174713773.f669092d.png"},616:function(s,a,t){s.exports=t.p+"assets/img/image-20200413214031331.1ac41a5f.png"},617:function(s,a,t){s.exports=t.p+"assets/img/image-20200413215133559.9abe54c9.png"},618:function(s,a,t){s.exports=t.p+"assets/img/image-20200514194111567.74cfa2f2.png"},619:function(s,a,t){s.exports=t.p+"assets/img/image-20200515002806726.a7f84e1b.png"},620:function(s,a,t){s.exports=t.p+"assets/img/image-20200520102949189.5fd250f6.png"},621:function(s,a,t){s.exports=t.p+"assets/img/image-20200520103942580.10834b9b.png"},622:function(s,a,t){s.exports=t.p+"assets/img/image-20200518211037434.9dff23bf.png"},623:function(s,a,t){s.exports=t.p+"assets/img/image-20200519181209566.b0891456.png"},624:function(s,a,t){s.exports=t.p+"assets/img/image-20200520144548997.38880d5b.png"},625:function(s,a,t){s.exports=t.p+"assets/img/image-20200520144959353.6ea0cd70.png"},626:function(s,a,t){s.exports=t.p+"assets/img/image-20200520154628679.008bd821.png"},627:function(s,a,t){s.exports=t.p+"assets/img/image-20200520162605102.26a03a73.png"},628:function(s,a,t){s.exports=t.p+"assets/img/image-20200520163253644.5df6652f.png"},629:function(s,a,t){s.exports=t.p+"assets/img/image-20200520163552110.c277dfdb.png"},630:function(s,a,t){s.exports=t.p+"assets/img/image-20200520163832827.d53635fb.png"},761:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("本章主要学习K8s的数据存储，安全认证，以及可视化界面DashBoard简单使用。根据"),n("a",{attrs:{href:"https://www.bilibili.com/video/BV1cK4y1L7Am?p=1",target:"_blank",rel:"noopener noreferrer"}},[s._v("哔哩哔哩黑马视频"),n("OutboundLink")],1),s._v("学习，学习来源于搬迁，部分文档有根据自己学习进行修改和补充，"),n("a",{attrs:{href:"https://www.orchome.com/1786",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档学习资源"),n("OutboundLink")],1)])]),s._v(" "),n("h1",{attrs:{id:"第八章-数据存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第八章-数据存储"}},[s._v("#")]),s._v(" 第八章 数据存储")]),s._v(" "),n("p",[s._v("​    在前面已经提到，容器的生命周期可能很短，会被频繁地创建和销毁。那么容器在销毁时，保存在容器中的数据也会被清除。这种结果对用户来说，在某些情况下是不乐意看到的。为了持久化保存容器的数据，kubernetes引入了Volume的概念。")]),s._v(" "),n("p",[s._v("​    Volume是Pod中能够被多个容器访问的共享目录，它被定义在Pod上，然后被一个Pod里的多个容器挂载到具体的文件目录下，kubernetes通过Volume实现同一个Pod中不同容器之间的数据共享以及数据的持久化存储。Volume的生命容器不与Pod中单个容器的生命周期相关，当容器终止或者重启时，Volume中的数据也不会丢失。")]),s._v(" "),n("p",[s._v("kubernetes的Volume支持多种类型，比较常见的有下面几个：")]),s._v(" "),n("ul",[n("li",[s._v("简单存储：EmptyDir、HostPath、NFS")]),s._v(" "),n("li",[s._v("高级存储：PV、PVC")]),s._v(" "),n("li",[s._v("配置存储：ConfigMap、Secret")])]),s._v(" "),n("h2",{attrs:{id:"基本存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本存储"}},[s._v("#")]),s._v(" 基本存储")]),s._v(" "),n("h3",{attrs:{id:"emptydir"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#emptydir"}},[s._v("#")]),s._v(" EmptyDir")]),s._v(" "),n("p",[s._v("​    EmptyDir是最基础的Volume类型，一个EmptyDir就是Host上的一个空目录。")]),s._v(" "),n("p",[s._v("​    EmptyDir是在Pod被分配到Node时创建的，它的初始内容为空，并且无须指定宿主机上对应的目录文件，因为kubernetes会自动分配一个目录，当Pod销毁时， EmptyDir中的数据也会被永久删除。 EmptyDir用途如下：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("临时空间，例如用于某些应用程序运行时所需的临时目录，且无须永久保留")])]),s._v(" "),n("li",[n("p",[s._v("一个容器需要从另一个容器中获取数据的目录（多容器共享目录）")])])]),s._v(" "),n("p",[s._v("接下来，通过一个容器之间文件共享的案例来使用一下EmptyDir。")]),s._v(" "),n("p",[s._v("​    在一个Pod中准备两个容器nginx和busybox，然后声明一个Volume分别挂在到两个容器的目录中，然后nginx容器负责向Volume中写日志，busybox中通过命令将日志内容读到控制台。")]),s._v(" "),n("img",{staticStyle:{zoom:"80%",border:"solid 1px"},attrs:{src:t(615)}}),s._v(" "),n("p",[s._v("创建一个volume-emptydir.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("emptydir\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.14"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将logs-volume挂在到nginx容器中，对应的目录为 /var/log/nginx")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/log/nginx\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail -f /logs/access.log"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始命令，动态读取指定文件中内容")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将logs-volume 挂在到busybox容器中，对应的目录为 /logs")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /logs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 声明volume， name为logs-volume，类型为emptyDir")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("emptyDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建Pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f volume-emptydir.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("emptydir created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods volume-emptydir -n dev -o wide")]),s._v("\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \nvolume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("emptydir   2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("2     Running   0          97s   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100   node1  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过podIp访问nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.1.100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过kubectl logs命令查看指定容器的标准输出")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs -f volume-emptydir -n dev -c busybox")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("13"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Apr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("2020:10:58:47 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("0000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" 200 612 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.29.0"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"hostpath"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hostpath"}},[s._v("#")]),s._v(" HostPath")]),s._v(" "),n("p",[s._v("​    上节课提到，EmptyDir中数据不会被持久化，它会随着Pod的结束而销毁，如果想简单的将数据持久化到主机中，可以选择HostPath。")]),s._v(" "),n("p",[s._v("​    HostPath就是将Node主机中一个实际目录挂在到Pod中，以供容器使用，这样的设计就可以保证Pod销毁了，但是数据依据可以存在于Node主机上。")]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(616)}}),s._v(" "),n("p",[s._v("创建一个volume-hostpath.yaml：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hostpath\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/log/nginx\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail -f /logs/access.log"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /logs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/logs\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DirectoryOrCreate  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目录存在就使用，不存在就先创建后使用")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("关于type的值的一点说明：\n\tDirectoryOrCreate 目录存在就使用，不存在就先创建后使用\n\tDirectory\t目录必须存在\n\tFileOrCreate  文件存在就使用，不存在就先创建后使用\n\tFile 文件必须存在\t\n    Socket\tunix套接字必须存在\n\tCharDevice\t字符设备必须存在\n\tBlockDevice 块设备必须存在\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建Pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f volume-hostpath.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostpath created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods volume-hostpath -n dev -o wide")]),s._v("\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostpath   2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("2     Running   0          16s   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("104   node1  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.1.104")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接下来就可以去host的/root/logs目录下查看存储的文件了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###  注意: 下面的操作需要到Pod所在的节点运行（案例中是node1）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@node1 ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /root/logs/")]),s._v("\naccess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同样的道理，如果在此目录下创建一个文件，到容器中也是可以看到的")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"nfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nfs"}},[s._v("#")]),s._v(" NFS")]),s._v(" "),n("p",[s._v("​    HostPath可以解决数据持久化的问题，但是一旦Node节点故障了，Pod如果转移到了别的节点，又会出现问题了，此时需要准备单独的网络存储系统，比较常用的用NFS、CIFS。")]),s._v(" "),n("p",[s._v("​    NFS是一个网络文件存储系统，可以搭建一台NFS服务器，然后将Pod中的存储直接连接到NFS系统上，这样的话，无论Pod在节点上怎么转移，只要Node跟NFS的对接没问题，数据就可以成功访问。")]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(617)}}),s._v(" "),n("p",[s._v("1）首先要准备nfs的服务器，这里为了简单，直接是master节点做nfs服务器")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在master上安装nfs服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install nfs-utils -y")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备一个共享目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /root/data/nfs -pv")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将共享目录以读写权限暴露给192.168.109.0/24网段中的所有主机")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/exports")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /etc/exports")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nfs     192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("24"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nfs服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start nfs")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("2）接下来，要在的每个node节点上都安装下nfs，这样的目的是为了node节点可以驱动nfs设备")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在node上安装nfs服务，注意不需要启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install nfs-utils -y")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("3）接下来，就可以编写pod的配置文件了，创建volume-nfs.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nfs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/log/nginx\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail -f /logs/access.log"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /logs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volume\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.109.100  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nfs服务器地址")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/data/nfs "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#共享文件路径")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("4）最后，运行下pod，观察结果")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f volume-nfs.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nfs created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods volume-nfs -n dev")]),s._v("\nNAME                  READY   STATUS    RESTARTS   AGE\nvolume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nfs        2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("2     Running   0          2m9s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nfs服务器上的共享目录，发现已经有文件了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /root/data/")]),s._v("\naccess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("##高级存储")]),s._v(" "),n("h3",{attrs:{id:"pv和pvc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pv和pvc"}},[s._v("#")]),s._v(" PV和PVC")]),s._v(" "),n("p",[s._v("​    前面已经学习了使用NFS提供存储，此时就要求用户会搭建NFS系统，并且会在yaml配置nfs。由于kubernetes支持的存储系统有很多，要求客户全都掌握，显然不现实。为了能够屏蔽底层存储实现的细节，方便用户使用， kubernetes引入PV和PVC两种资源对象。")]),s._v(" "),n("p",[s._v("​    PV（Persistent Volume）是持久化卷的意思，是对底层的共享存储的一种抽象。一般情况下PV由kubernetes管理员进行创建和配置，它与底层具体的共享存储技术有关，并通过插件完成与共享存储的对接。")]),s._v(" "),n("p",[s._v("​    PVC（Persistent Volume Claim）是持久卷声明的意思，是用户对于存储需求的一种声明。换句话说，PVC其实就是用户向kubernetes系统发出的一种资源需求申请。")]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(618)}}),s._v(" "),n("p",[s._v("使用了PV和PVC之后，工作可以得到进一步的细分：")]),s._v(" "),n("ul",[n("li",[s._v("存储：存储工程师维护")]),s._v(" "),n("li",[s._v("PV：  kubernetes管理员维护")]),s._v(" "),n("li",[s._v("PVC：kubernetes用户维护")])]),s._v(" "),n("h3",{attrs:{id:"pv"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pv"}},[s._v("#")]),s._v(" PV")]),s._v(" "),n("p",[s._v("PV是存储资源的抽象，下面是资源清单文件:")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1  \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pv2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储类型，与底层真正存储对应")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储能力，目前只支持存储空间的设置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2Gi\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储类别")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 回收策略")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("PV 的关键配置参数说明：")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("存储类型")])]),s._v(" "),n("p",[s._v("底层实际存储的类型，kubernetes支持多种存储类型，每种存储类型的配置都有所差异")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("存储能力（capacity）")])])])]),s._v(" "),n("p",[s._v("​      目前只支持存储空间的设置( storage=1Gi )，不过未来可能会加入IOPS、吞吐量等指标的配置")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("访问模式（accessModes）")])]),s._v(" "),n("p",[s._v("用于描述用户应用对存储资源的访问权限，访问权限包括下面几种方式：")]),s._v(" "),n("ul",[n("li",[s._v("ReadWriteOnce（RWO）：读写权限，但是只能被单个节点挂载")]),s._v(" "),n("li",[s._v("ReadOnlyMany（ROX）：  只读权限，可以被多个节点挂载")]),s._v(" "),n("li",[s._v("ReadWriteMany（RWX）：读写权限，可以被多个节点挂载")])]),s._v(" "),n("p",[n("code",[s._v("需要注意的是，底层不同的存储类型可能支持的访问模式不同")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("回收策略（persistentVolumeReclaimPolicy）")])]),s._v(" "),n("p",[s._v("当PV不再被使用了之后，对其的处理方式。目前支持三种策略：")]),s._v(" "),n("ul",[n("li",[s._v("Retain  （保留）  保留数据，需要管理员手工清理数据")]),s._v(" "),n("li",[s._v("Recycle（回收）  清除 PV 中的数据，效果相当于执行 rm -rf /thevolume/*")]),s._v(" "),n("li",[s._v("Delete  （删除） 与 PV 相连的后端存储完成 volume 的删除操作，当然这常见于云服务商的存储服务")])]),s._v(" "),n("p",[n("code",[s._v("需要注意的是，底层不同的存储类型可能支持的回收策略不同")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("存储类别")])]),s._v(" "),n("p",[s._v("PV可以通过storageClassName参数指定一个存储类别")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("具有特定类别的PV只能与请求了该类别的PVC进行绑定")])]),s._v(" "),n("li",[n("p",[s._v("未设定类别的PV则只能与不请求任何类别的PVC进行绑定")])])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("状态（status）")])]),s._v(" "),n("p",[s._v("一个 PV 的生命周期中，可能会处于4中不同的阶段：")]),s._v(" "),n("ul",[n("li",[s._v("Available（可用）：     表示可用状态，还未被任何 PVC 绑定")]),s._v(" "),n("li",[s._v("Bound（已绑定）：     表示 PV 已经被 PVC 绑定")]),s._v(" "),n("li",[s._v("Released（已释放）： 表示 PVC 被删除，但是资源还未被集群重新声明")]),s._v(" "),n("li",[s._v("Failed（失败）：         表示该 PV 的自动回收失败")])])])]),s._v(" "),n("p",[n("strong",[s._v("实验")])]),s._v(" "),n("p",[s._v("使用NFS作为存储，来演示PV的使用，创建3个PV，对应NFS中的3个暴露的路径。")]),s._v(" "),n("ol",[n("li",[s._v("准备NFS环境")])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /root/data/{pv1,pv2,pv3} -pv")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /etc/exports")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv1     192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("24"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv2     192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("24"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv3     192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("109"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("24"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  systemctl restart nfs")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("创建pv.yaml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  pv1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1Gi\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/data/pv1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.109.100\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  pv2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2Gi\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/data/pv2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.109.100\n    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  pv3\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3Gi\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/data/pv3\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.109.100\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f pv.yaml")]),s._v("\npersistentvolume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv1 created\npersistentvolume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv2 created\npersistentvolume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pv3 created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv -o wide")]),s._v("\nNAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE\npv1    1Gi        RWX            Retain        Available    10s   Filesystem\npv2    2Gi        RWX            Retain        Available    10s   Filesystem\npv3    3Gi        RWX            Retain        Available    9s    Filesystem\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"pvc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pvc"}},[s._v("#")]),s._v(" PVC")]),s._v(" "),n("p",[s._v("PVC是资源的申请，用来声明对存储空间、访问模式、存储类别需求信息。下面是资源清单文件:")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问模式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用标签对PV选择")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储类别")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求空间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5Gi\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("PVC 的关键配置参数说明：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("访问模式（accessModes）")])])]),s._v(" "),n("p",[s._v("​       用于描述用户应用对存储资源的访问权限")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("选择条件（selector）")])]),s._v(" "),n("p",[s._v("通过Label Selector的设置，可使PVC对于系统中己存在的PV进行筛选")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("存储类别（storageClassName）")])]),s._v(" "),n("p",[s._v("PVC在定义时可以设定需要的后端存储的类别，只有设置了该class的pv才能被系统选出")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("资源请求（Resources ）")])]),s._v(" "),n("p",[s._v("描述对存储资源的请求")])])]),s._v(" "),n("p",[n("strong",[s._v("实验")])]),s._v(" "),n("ol",[n("li",[s._v("创建pvc.yaml，申请pv")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc1\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1Gi\n      \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc2\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1Gi\n     \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc3\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1Gi\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建pvc")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f pvc.yaml")]),s._v("\npersistentvolumeclaim"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc1 created\npersistentvolumeclaim"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc2 created\npersistentvolumeclaim"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc3 created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pvc")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pvc  -n dev -o wide")]),s._v("\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem\npvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem\npvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv -o wide")]),s._v("\nNAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWx        Retain          Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc1    3h37m    Filesystem\npv2    2Gi        RWX        Retain          Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc2    3h37m    Filesystem\npv3    3Gi        RWX        Retain          Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc3    3h37m    Filesystem   \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("创建pods.yaml, 使用pv")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod1\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true;do echo pod1 >> /root/out.txt; sleep 10; done;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc1\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod2\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true;do echo pod2 >> /root/out.txt; sleep 10; done;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" volume\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pvc2\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("        \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f pods.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pod1 created\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pod2 created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n dev -o wide")]),s._v("\nNAME   READY   STATUS    RESTARTS   AGE   IP            NODE   \npod1   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          14s   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("69   node1   \npod2   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          14s   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("70   node1  \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pvc")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pvc -n dev -o wide")]),s._v("\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX               94m   Filesystem\npvc2   Bound    pv2      2Gi        RWX               94m   Filesystem\npvc3   Bound    pv3      3Gi        RWX               94m   Filesystem\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv -n dev -o wide")]),s._v("\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWX            Retain           Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc1    5h11m   Filesystem\npv2    2Gi        RWX            Retain           Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc2    5h11m   Filesystem\npv3    3Gi        RWX            Retain           Bound    dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pvc3    5h11m   Filesystem\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nfs中的文件存储")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /root/data/pv1/out.txt")]),s._v("\nnode1\nnode1\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /root/data/pv2/out.txt")]),s._v("\nnode2\nnode2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h3",{attrs:{id:"生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[s._v("#")]),s._v(" 生命周期")]),s._v(" "),n("p",[s._v("PVC和PV是一一对应的，PV和PVC之间的相互作用遵循以下生命周期：")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("资源供应")]),s._v("：管理员手动创建底层存储和PV")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("资源绑定")]),s._v("：用户创建PVC，kubernetes负责根据PVC的声明去寻找PV，并绑定")]),s._v(" "),n("p",[s._v("在用户定义好PVC之后，系统将根据PVC对存储资源的请求在已存在的PV中选择一个满足条件的")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("一旦找到，就将该PV与用户定义的PVC进行绑定，用户的应用就可以使用这个PVC了")])]),s._v(" "),n("li",[n("p",[s._v("如果找不到，PVC则会无限期处于Pending状态，直到等到系统管理员创建了一个符合其要求的PV")])])]),s._v(" "),n("p",[s._v("PV一旦绑定到某个PVC上，就会被这个PVC独占，不能再与其他PVC进行绑定了")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("资源使用")]),s._v("：用户可在pod中像volume一样使用pvc")]),s._v(" "),n("p",[s._v("Pod使用Volume的定义，将PVC挂载到容器内的某个路径进行使用。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("资源释放")]),s._v("：用户删除pvc来释放pv")]),s._v(" "),n("p",[s._v("当存储资源使用完毕后，用户可以删除PVC，与该PVC绑定的PV将会被标记为“已释放”，但还不能立刻与其他PVC进行绑定。通过之前PVC写入的数据可能还被留在存储设备上，只有在清除之后该PV才能再次使用。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("资源回收")]),s._v("：kubernetes根据pv设置的回收策略进行资源的回收")]),s._v(" "),n("p",[s._v("对于PV，管理员可以设定回收策略，用于设置与之绑定的PVC释放资源之后如何处理遗留数据的问题。只有PV的存储空间完成回收，才能供新的PVC绑定和使用")])])]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(619)}}),s._v(" "),n("h2",{attrs:{id:"配置存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置存储"}},[s._v("#")]),s._v(" 配置存储")]),s._v(" "),n("h3",{attrs:{id:"configmap"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[s._v("#")]),s._v(" ConfigMap")]),s._v(" "),n("p",[s._v("ConfigMap是一种比较特殊的存储卷，它的主要作用是用来存储配置信息的。")]),s._v(" "),n("p",[s._v("创建configmap.yaml，内容如下：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConfigMap\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" configmap\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n    username:admin\n    password:123456")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("接下来，使用此配置文件创建configmap")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建configmap")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f configmap.yaml")]),s._v("\nconfigmap"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configmap created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看configmap详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe cm configmap -n dev")]),s._v("\nName:         configmap\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Data")]),s._v("\n====\ninfo:\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\nusername:admin\npassword:123456\n\nEvents:  <none>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("接下来创建一个pod-configmap.yaml，将上面创建的configmap挂载进去")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("configmap\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将configmap挂载到目录")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /configmap/config\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用configmap")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" configmap\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f pod-configmap.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("configmap created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod pod-configmap -n dev")]),s._v("\nNAME            READY   STATUS    RESTARTS   AGE\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("configmap   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          6s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it pod-configmap -n dev /bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /configmap/config/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\ninfo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more info")]),s._v("\nusername:admin\npassword:123456\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到映射已经成功，每个configmap都映射成了一个目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key---\x3e文件     value----\x3e文件中的内容")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时如果更新configmap的内容, 容器中的值也会动态更新")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"secret"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#secret"}},[s._v("#")]),s._v(" Secret")]),s._v(" "),n("p",[s._v("​    在kubernetes中，还存在一种和ConfigMap非常类似的对象，称为Secret对象。它主要用于存储敏感信息，例如密码、秘钥、证书等等。")]),s._v(" "),n("ol",[n("li",[s._v("首先使用base64对数据进行编码")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo -n 'admin' | base64 #准备username")]),s._v("\nYWRtaW4=\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo -n '123456' | base64 #准备password")]),s._v("\nMTIzNDU2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("接下来编写secret.yaml，并创建Secret")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Secret\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" secret\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Opaque\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" YWRtaW4=\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MTIzNDU2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建secret")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f secret.yaml")]),s._v("\nsecret"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("secret created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看secret详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe secret secret -n dev")]),s._v("\nName:         secret\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Type")]),s._v(":  Opaque\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Data")]),s._v("\n====\npassword:  6 bytes\nusername:  5 bytes\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("创建pod-secret.yaml，将上面创建的secret挂载进去：")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("secret\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将secret挂载到目录")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /secret/config\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" secret\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f pod-secret.yaml")]),s._v("\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("secret created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod pod-secret -n dev")]),s._v("\nNAME            READY   STATUS    RESTARTS   AGE\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("secret      1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          2m28s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器，查看secret信息，发现已经自动解码了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it pod-secret /bin/sh -n dev")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /secret/config/")]),s._v("\npassword  username\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /secret/config/username")]),s._v("\nadmin\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /secret/config/password")]),s._v("\n123456\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("至此，已经实现了利用secret实现了信息的编码。")]),s._v(" "),n("h1",{attrs:{id:"第九章-安全认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第九章-安全认证"}},[s._v("#")]),s._v(" 第九章 安全认证")]),s._v(" "),n("p",[s._v("本章节主要介绍Kubernetes的安全认证机制。")]),s._v(" "),n("h2",{attrs:{id:"访问控制概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问控制概述"}},[s._v("#")]),s._v(" 访问控制概述")]),s._v(" "),n("p",[s._v("​    Kubernetes作为一个分布式集群的管理工具，保证集群的安全性是其一个重要的任务。所谓的安全性其实就是保证对Kubernetes的各种"),n("strong",[s._v("客户端")]),s._v("进行"),n("strong",[s._v("认证和鉴权")]),s._v("操作。")]),s._v(" "),n("p",[n("strong",[s._v("客户端")])]),s._v(" "),n("p",[s._v("在Kubernetes集群中，客户端通常有两类：")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("User Account")]),s._v("：一般是独立于kubernetes之外的其他服务管理的用户账号。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Service Account")]),s._v("：kubernetes管理的账号，用于为Pod中的服务进程在访问Kubernetes时提供身份标识。")])])]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(620)}}),s._v(" "),n("p",[n("strong",[s._v("认证、授权与准入控制")])]),s._v(" "),n("p",[s._v("ApiServer是访问及管理资源对象的唯一入口。任何一个请求访问ApiServer，都要经过下面三个流程：")]),s._v(" "),n("ul",[n("li",[s._v("Authentication（认证）：身份鉴别，只有正确的账号才能够通过认证")]),s._v(" "),n("li",[s._v("Authorization（授权）：  判断用户是否有权限对访问的资源执行特定的动作")]),s._v(" "),n("li",[s._v("Admission Control（准入控制）：用于补充授权机制以实现更加精细的访问控制功能。")])]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(621)}}),s._v(" "),n("h2",{attrs:{id:"认证管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#认证管理"}},[s._v("#")]),s._v(" 认证管理")]),s._v(" "),n("p",[s._v("Kubernetes集群安全的最关键点在于如何识别并认证客户端身份，它提供了3种客户端身份认证方式：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("HTTP Base认证：通过用户名+密码的方式认证")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("    这种认证方式是把“用户名:密码”用BASE64算法进行编码后的字符串放在HTTP请求中的Header Authorization域里发送给服务端。服务端收到后进行解码，获取用户名及密码，然后进行用户身份认证的过程。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("HTTP Token认证：通过一个Token来识别合法用户")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("    这种认证方式是用一个很长的难以被模仿的字符串--Token来表明客户身份的一种方式。每个Token对应一个用户名，当客户端发起API调用请求时，需要在HTTP Header里放入Token，API Server接到Token后会跟服务器中保存的token进行比对，然后进行用户身份认证的过程。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("HTTPS证书认证：基于CA根证书签名的双向数字证书认证方式")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("    这种认证方式是安全性最高的一种方式，但是同时也是操作起来最麻烦的一种方式。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(622)}}),s._v(" "),n("p",[n("strong",[s._v("HTTPS认证大体分为3个过程：")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("证书申请和下发")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("  HTTPS通信双方的服务器向CA机构申请证书，CA机构下发根证书、服务端证书及私钥给申请者\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("客户端和服务端的双向认证")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("  1> 客户端向服务器端发起请求，服务端下发自己的证书给客户端，\n     客户端接收到证书后，通过私钥解密证书，在证书中获得服务端的公钥，\n     客户端利用服务器端的公钥认证证书中的信息，如果一致，则认可这个服务器\n  2> 客户端发送自己的证书给服务器端，服务端接收到证书后，通过私钥解密证书，\n     在证书中获得客户端的公钥，并用该公钥认证证书信息，确认客户端是否合法\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("服务器端和客户端进行通信")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("  服务器端和客户端协商好加密方案后，客户端会产生一个随机的秘钥并加密，然后发送到服务器端。\n  服务器端接收这个秘钥后，双方接下来通信的所有内容都通过该随机秘钥加密\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("blockquote",[n("p",[s._v("注意:  Kubernetes允许同时配置多种认证方式，只要其中任意一个方式认证通过即可")])]),s._v(" "),n("h2",{attrs:{id:"授权管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权管理"}},[s._v("#")]),s._v(" 授权管理")]),s._v(" "),n("p",[s._v("​     授权发生在认证成功之后，通过认证就可以知道请求用户是谁， 然后Kubernetes会根据事先定义的授权策略来决定用户是否有权限访问，这个过程就称为授权。")]),s._v(" "),n("p",[s._v("​     每个发送到ApiServer的请求都带上了用户和资源的信息：比如发送请求的用户、请求的路径、请求的动作等，授权就是根据这些信息和授权策略进行比较，如果符合策略，则认为授权通过，否则会返回错误。")]),s._v(" "),n("p",[s._v("API Server目前支持以下几种授权策略：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("AlwaysDeny：表示拒绝所有请求，一般用于测试")])]),s._v(" "),n("li",[n("p",[s._v("AlwaysAllow：允许接收所有请求，相当于集群不需要授权流程（Kubernetes默认的策略）")])]),s._v(" "),n("li",[n("p",[s._v("ABAC：基于属性的访问控制，表示使用用户配置的授权规则对用户请求进行匹配和控制")])]),s._v(" "),n("li",[n("p",[s._v("Webhook：通过调用外部REST服务对用户进行授权")])]),s._v(" "),n("li",[n("p",[s._v("Node：是一种专用模式，用于对kubelet发出的请求进行访问控制")])]),s._v(" "),n("li",[n("p",[s._v("RBAC：基于角色的访问控制（kubeadm安装方式下的默认选项）")])])]),s._v(" "),n("p",[s._v("RBAC(Role-Based Access Control) 基于角色的访问控制，主要是在描述一件事情："),n("strong",[s._v("给哪些对象授予了哪些权限")])]),s._v(" "),n("p",[s._v("其中涉及到了下面几个概念：")]),s._v(" "),n("ul",[n("li",[s._v("对象：User、Groups、ServiceAccount")]),s._v(" "),n("li",[s._v("角色：代表着一组定义在资源上的可操作动作(权限)的集合")]),s._v(" "),n("li",[s._v("绑定：将定义好的角色跟用户绑定在一起")])]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(623)}}),s._v(" "),n("p",[s._v("RBAC引入了4个顶级资源对象：")]),s._v(" "),n("ul",[n("li",[s._v("Role、ClusterRole：角色，用于指定一组权限")]),s._v(" "),n("li",[s._v("RoleBinding、ClusterRoleBinding：角色绑定，用于将角色（权限）赋予给对象")])]),s._v(" "),n("p",[n("strong",[s._v("Role、ClusterRole")])]),s._v(" "),n("p",[s._v("一个角色就是一组权限的集合，这里的权限都是许可形式的（白名单）。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Role只能对命名空间内的资源进行授权，需要指定nameapce")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n  name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 支持的API组列表,"" 空字符串，表示核心API群')]),s._v("\n  resources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持的资源对象列表")]),s._v("\n  verbs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许的对资源对象的操作方法列表")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ClusterRole可以对集群范围内资源、跨namespaces的范围资源、非资源类型进行授权")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("需要详细说明的是，rules中的参数：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("apiGroups: 支持的API组列表")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apps"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoscaling"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"batch"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("resources：支持的资源对象列表")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"services"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"endpoints"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secrets"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"configmaps"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"crontabs"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deployments"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jobs"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodes"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rolebindings"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clusterroles"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemonsets"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"replicasets"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"statefulsets"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"horizontalpodautoscalers"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"replicationcontrollers"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cronjobs"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("verbs：对资源对象的操作方法列表")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("p",[n("strong",[s._v("RoleBinding、ClusterRoleBinding")])]),s._v(" "),n("p",[s._v("角色绑定用来把一个角色绑定到一个目标对象上，绑定目标可以是User、Group或者ServiceAccount。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RoleBinding可以将同一namespace中的subject绑定到某个Role下，则此subject即具有该Role定义的权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("binding\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" heima\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ClusterRoleBinding在整个集群级别和所有namespaces将特定的subject与ClusterRole绑定，授予权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("binding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" heima\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("strong",[s._v("RoleBinding引用ClusterRole进行授权")])]),s._v(" "),n("p",[s._v("RoleBinding可以引用ClusterRole，对属于同一命名空间内ClusterRole定义的资源主体进行授权。")]),s._v(" "),n("div",{staticClass:"language-markdown line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markdown"}},[n("code",[s._v("    一种很常用的做法就是，集群管理员为集群范围预定义好一组角色（ClusterRole），然后在多个命名空间中重复使用这些ClusterRole。这样可以大幅提高授权管理工作效率，也使得各个命名空间下的基础性授权规则与使用体验保持一致。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虽然authorization-clusterrole是一个集群角色，但是因为使用了RoleBinding")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以heima只能读取dev命名空间中的资源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("binding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns\n  namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" heima\n  apiGroup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  kind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole\n  apiGroup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[n("strong",[s._v("实战：创建一个只能管理dev空间下Pods资源的账号")])]),s._v(" "),n("ol",[n("li",[s._v("创建账号")])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1) 创建证书")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/kubernetes/pki/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (umask 077;openssl genrsa -out devman.key 2048)")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2) 用apiserver的证书去签署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2-1) 签名申请，申请的用户是devman,组是devgroup")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# openssl req -new -key devman.key -out devman.csr -subj "/CN=devman/O=devgroup"     ')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2-2) 签署证书")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3) 设置集群、用户、上下文信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换账户到devman")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config use-context devman@kubernetes")]),s._v("\nSwitched to context "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devman@kubernetes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看dev下pod，发现没有权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n dev")]),s._v("\nError "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Forbidden"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": pods is forbidden: User "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devman"')]),s._v(" cannot list resource "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),s._v(" in API "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("group")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" in the namespace "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换到admin账户")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config use-context kubernetes-admin@kubernetes")]),s._v("\nSwitched to context "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-admin@kubernetes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("2） 创建Role和RoleBinding，为devman用户授权"),n("code",[s._v("dev-role.yaml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("binding\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" devman\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f dev-role.yaml")]),s._v("\nrole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("role created\nrolebinding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("role"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding created\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("切换账户，再次验证")])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换账户到devman")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config use-context devman@kubernetes")]),s._v("\nSwitched to context "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devman@kubernetes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n dev")]),s._v("\nNAME                                 READY   STATUS             RESTARTS   AGE\nnginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("8wp2k    1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running            0          4d1h\nnginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dc46j    1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running            0          4d1h\nnginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("thfck    1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running            0          4d1h\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为了不影响后面的学习,切回admin账户")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master pki]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl config use-context kubernetes-admin@kubernetes")]),s._v("\nSwitched to context "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-admin@kubernetes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"准入控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准入控制"}},[s._v("#")]),s._v(" 准入控制")]),s._v(" "),n("p",[s._v("通过了前面的认证和授权之后，还需要经过准入控制处理通过之后，apiserver才会处理这个请求。")]),s._v(" "),n("p",[s._v("准入控制是一个可配置的控制器列表，可以通过在Api-Server上通过命令行设置选择执行哪些准入控制器：")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control=NamespaceLifecycle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("LimitRanger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ServiceAccount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("PersistentVolumeLabel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      DefaultStorageClass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ResourceQuota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("DefaultTolerationSeconds\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("只有当所有的准入控制器都检查通过之后，apiserver才执行该请求，否则返回拒绝。")]),s._v(" "),n("p",[s._v("当前可配置的Admission Control准入控制如下：")]),s._v(" "),n("ul",[n("li",[s._v("AlwaysAdmit：允许所有请求")]),s._v(" "),n("li",[s._v("AlwaysDeny：禁止所有请求，一般用于测试")]),s._v(" "),n("li",[s._v("AlwaysPullImages：在启动容器之前总去下载镜像")]),s._v(" "),n("li",[s._v("DenyExecOnPrivileged：它会拦截所有想在Privileged Container上执行命令的请求")]),s._v(" "),n("li",[s._v("ImagePolicyWebhook：这个插件将允许后端的一个Webhook程序来完成admission controller的功能。")]),s._v(" "),n("li",[s._v("Service Account：实现ServiceAccount实现了自动化")]),s._v(" "),n("li",[s._v("SecurityContextDeny：这个插件将使用SecurityContext的Pod中的定义全部失效")]),s._v(" "),n("li",[s._v("ResourceQuota：用于资源配额管理目的，观察所有请求，确保在namespace上的配额不会超标")]),s._v(" "),n("li",[s._v("LimitRanger：用于资源限制管理，作用于namespace上，确保对Pod进行资源限制")]),s._v(" "),n("li",[s._v("InitialResources：为未设置资源请求与限制的Pod，根据其镜像的历史资源的使用情况进行设置")]),s._v(" "),n("li",[s._v("NamespaceLifecycle：如果尝试在一个不存在的namespace中创建资源对象，则该创建请求将被拒绝。当删除一个namespace时，系统将会删除该namespace中所有对象。")]),s._v(" "),n("li",[s._v("DefaultStorageClass：为了实现共享存储的动态供应，为未指定StorageClass或PV的PVC尝试匹配默认的StorageClass，尽可能减少用户在申请PVC时所需了解的后端存储细节")]),s._v(" "),n("li",[s._v("DefaultTolerationSeconds：这个插件为那些没有设置forgiveness tolerations并具有notready:NoExecute和unreachable:NoExecute两种taints的Pod设置默认的“容忍”时间，为5min")]),s._v(" "),n("li",[s._v("PodSecurityPolicy：这个插件用于在创建或修改Pod时决定是否根据Pod的security context和可用的PodSecurityPolicy对Pod的安全策略进行控制")])]),s._v(" "),n("h1",{attrs:{id:"第十章-dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第十章-dashboard"}},[s._v("#")]),s._v(" 第十章 DashBoard")]),s._v(" "),n("p",[s._v("​    之前在kubernetes中完成的所有操作都是通过命令行工具kubectl完成的。其实，为了提供更丰富的用户体验，kubernetes还开发了一个基于web的用户界面（Dashboard）。用户可以使用Dashboard部署容器化的应用，还可以监控应用的状态，执行故障排查以及管理kubernetes中各种资源。")]),s._v(" "),n("h2",{attrs:{id:"部署dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署dashboard"}},[s._v("#")]),s._v(" 部署Dashboard")]),s._v(" "),n("ol",[n("li",[s._v("下载yaml，并运行Dashboard")])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改kubernetes-dashboard的Service类型")]),s._v("\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app: kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n  name: kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n  namespace: kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\nspec:\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("type")]),s._v(": NodePort  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增")]),s._v("\n  ports:\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port: 443\n      targetPort: 8443\n      nodePort: 30009  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增")]),s._v("\n  selector:\n    k8s"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app: kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f recommended.yaml")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看namespace下的kubernetes-dashboard下的资源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod,svc -n kubernetes-dashboard")]),s._v("\nNAME                                            READY   STATUS    RESTARTS   AGE\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scraper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c79c65bb7"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zwfvw   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          111s\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("56484d4c5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("z95z5        1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          111s\n\nNAME                               "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("       CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP      EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP  PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         AGE\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scraper  ClusterIP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("89"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("218    <none>       8000"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP        111s\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard       NodePort   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("104"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("178"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("171  <none>       443:30009"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP   111s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("p",[s._v("2）创建访问账户，获取token")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建账号")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master-1 ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master-1 ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取账号token")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin")]),s._v("\ndashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g5fp7        kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token   3      2m35s\n\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe secrets dashboard-admin-token-g5fp7 -n kubernetes-dashboard")]),s._v("\nName:         dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xbqhh\nNamespace:    kubernetes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\nLabels:       <none>\nAnnotations:  kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name: dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin\n              kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uid: 95d84d80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("be7a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("4d10"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a2e0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("68f90222d039\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Type")]),s._v(":  kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Data")]),s._v("\n====\nnamespace:  20 bytes\ntoken:     eyJhbGciOiJSUzI1NiIsImtpZCI6IjBwb3BQdjNibDlfeDVjeWtHQXB3R2R5QkdQUXpWaG4xNkRwTHdSdkZ1NlEifQ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tZzVmcDciLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiZTk3ZGQzZjQtMzMwNi00YmJkLTgxMWQtY2JhYjQyMmVlYTI4Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Mtqa0sbBvnF2XFnrmdkoQCbegBqpr9kRBKGZFrnBn_qldCUVS0Fswyouws"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sTEGvguD91veHLHrXNzoR5OPoEG3b11RT5mGRff7v2Rarau3E9GwprrMfqzaDpNNdLr9edFNrGnJD68SSSMuLpKRkG5wiMKq7VXS357XrzHD7B5rwIwY3FWROtqxw2M6uldB87PWKuBWAucy0stXco9G1az3YoHWxdH_Ce44TK3851vF1VikdyWj9F6ILw"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f2czcRMUxfgynaZ7YSuLYAs4uSr8LoDwlh0gm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tW2uceA9rm0WxORfGFMbyC4X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("DXSErqIx8EQiILahN4t7cjzfFRfBQ\nca"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt:     1025 bytes\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("3）通过浏览器访问Dashboard的UI")]),s._v(" "),n("p",[s._v("https://192.168.40.100:30009/#/login")]),s._v(" "),n("p",[s._v("在登录页面上输入上面的token")]),s._v(" "),n("img",{staticStyle:{zoom:"80%",border:"1px solid"},attrs:{src:t(624),alt:"image-20200520144548997"}}),s._v(" "),n("p",[s._v("出现下面的页面代表成功")]),s._v(" "),n("img",{staticStyle:{zoom:"80%",border:"1px solid"},attrs:{src:t(625),alt:"image-20200520144959353"}}),s._v(" "),n("h2",{attrs:{id:"使用dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用dashboard"}},[s._v("#")]),s._v(" 使用DashBoard")]),s._v(" "),n("p",[s._v("本章节以Deployment为例演示DashBoard的使用")]),s._v(" "),n("p",[n("strong",[s._v("查看")])]),s._v(" "),n("p",[s._v("选择指定的命名空间"),n("code",[s._v("dev")]),s._v("，然后点击"),n("code",[s._v("Deployments")]),s._v("，查看dev空间下的所有deployment")]),s._v(" "),n("img",{staticStyle:{zoom:"90%",border:"1px solid"},attrs:{src:t(626)}}),s._v(" "),n("p",[n("strong",[s._v("扩缩容")])]),s._v(" "),n("p",[s._v("在"),n("code",[s._v("Deployment")]),s._v("上点击"),n("code",[s._v("规模")]),s._v("，然后指定"),n("code",[s._v("目标副本数量")]),s._v("，点击确定")]),s._v(" "),n("img",{staticStyle:{zoom:"90%",border:"1px solid"},attrs:{src:t(627)}}),s._v(" "),n("p",[n("strong",[s._v("编辑")])]),s._v(" "),n("p",[s._v("在"),n("code",[s._v("Deployment")]),s._v("上点击"),n("code",[s._v("编辑")]),s._v("，然后修改"),n("code",[s._v("yaml文件")]),s._v("，点击确定")]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:t(628),alt:"image-20200520163253644"}}),s._v(" "),n("p",[n("strong",[s._v("查看Pod")])]),s._v(" "),n("p",[s._v("点击"),n("code",[s._v("Pods")]),s._v(", 查看pods列表")]),s._v(" "),n("img",{staticStyle:{zoom:"90%",border:"1px solid"},attrs:{src:t(629)}}),s._v(" "),n("p",[n("strong",[s._v("操作Pod")])]),s._v(" "),n("p",[s._v("选中某个Pod，可以对其执行日志（logs）、进入执行（exec）、编辑、删除操作")]),s._v(" "),n("img",{staticStyle:{zoom:"90%",border:"1px solid"},attrs:{src:t(630)}}),s._v(" "),n("blockquote",[n("p",[s._v("Dashboard提供了kubectl的绝大部分功能，这里不再一一演示")])])])}),[],!1,null,null,null);a.default=e.exports}}]);