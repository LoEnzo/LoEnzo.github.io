(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{542:function(t,v,_){t.exports=_.p+"assets/img/flume1.a6e5fe3c.png"},543:function(t,v,_){t.exports=_.p+"assets/img/flume2.46609584.png"},544:function(t,v,_){t.exports=_.p+"assets/img/flume3.8f962a52.png"},656:function(t,v,_){"use strict";_.r(v);var a=_(4),e=Object(a.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v("Flume 是一个分布式、可靠、和高可用的海量日志聚合的系统，支持在系统中定制各类数据发送方，通过"),a("strong",[t._v("监控整个文件目录或者某一个特定文件，用于收集数据")]),t._v("；同时Flume也 提供数据写到各种数据接受方(可定制)的能力，"),a("strong",[t._v("用于转发数据")]),t._v("。Flume 的易用性在于通过读取配置文件，可以自动收集日志文件，在大数据处理及各种复杂的情况下，flume 经常被用来作为数据处理的工具。")])]),t._v(" "),a("h2",{attrs:{id:"工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[t._v("#")]),t._v(" 工作流程")]),t._v(" "),a("p",[a("img",{attrs:{src:_(542),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"安装启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装启动"}},[t._v("#")]),t._v(" 安装启动")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("命令或下载压缩包安装；")])]),t._v(" "),a("li",[a("p",[t._v("添加环境变量：")]),t._v(" "),a("p",[t._v("复制一份"),a("code",[t._v("conf/flume.env.sh.template")]),t._v("取消"),a("code",[t._v(".template")]),t._v("后缀，在里面添加系统"),a("code",[t._v("JAVA_HOME")]),t._v("环境变量；")]),t._v(" "),a("p",[t._v("在系统环境变量里添加"),a("code",[t._v("${FLUME_HOME}=flume安装目录")]),t._v("，再把bin目录添加到"),a("code",[t._v("$FLUME_HOME/bin:$PATH")]),t._v(";")])]),t._v(" "),a("li",[a("p",[t._v("刷新环境变量，输入"),a("code",[t._v("flume-ng version")]),t._v("能看到版本号相关信息即安装成功；")])]),t._v(" "),a("li",[a("p",[t._v("flume启动命令解析")])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 完整命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" flume-ng agent --name agent --conf "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf --conf-file "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf/kafka.properties -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("INFO,console "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分布解析")]),t._v("\nflume-ng agent\n--name a1         \t\t\t\t\t \t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件中设置的a1  a1.sources = r1")]),t._v("\n-conf "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf   \t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件的路径")]),t._v("\n--confi-file "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf/demo.properties\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定配置文件")]),t._v("\n-Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("INFO,console\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指令启动后控制台输入日志，后台启动可以不加此命令")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"参数配置详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数配置详解"}},[t._v("#")]),t._v(" 参数配置详解")]),t._v(" "),a("h3",{attrs:{id:"核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[t._v("#")]),t._v(" 核心概念")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Flume组件")]),t._v(" "),a("th",[t._v("介绍")]),t._v(" "),a("th",[t._v("理解")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("source")])]),t._v(" "),a("td",[t._v("采集日志数据，将采集到的日志数据传输给channel")]),t._v(" "),a("td",[t._v("数据来源的地方")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("channel")])]),t._v(" "),a("td",[t._v("一个队列，存储source传递过来的数据")]),t._v(" "),a("td",[t._v("数据传输的管道")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("sink")])]),t._v(" "),a("td",[t._v("从channel中获取数据，将数据输出到目标位置（HDFS、HBase、Source）")]),t._v(" "),a("td",[t._v("数据要传送到那里去")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Event")])]),t._v(" "),a("td",[t._v("传输数据的单元，Flume中采集数据并传输的最小单位")]),t._v(" "),a("td",[t._v("数据传输的单位")])])])]),t._v(" "),a("h3",{attrs:{id:"sources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sources"}},[t._v("#")]),t._v(" Sources")]),t._v(" "),a("p",[t._v("Flume中常用的Source有"),a("strong",[t._v("NetCat，Avro，Exec，Spooling Directory，Taildir")]),t._v("，也可以根据业务场景的需要自定义Source,具体介绍如下。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Sources")]),t._v(" "),a("th",[t._v("使用场景")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("NetCat")])]),t._v(" "),a("td",[t._v("NetCat Source可以使用TCP和UDP两种协议方式，使用方法基本相同，通过"),a("strong",[t._v("监听指定的IP和端口来传输数据")]),t._v("，它会将监听到的每一行数据转化成一个Event写入到Channel中。（必须参数以@标示，下类同）")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Avro")])]),t._v(" "),a("td",[t._v("不同主机上的Agent通过网络传输数据可使用的Source，一般是接受Avro client的数据，或和是上一级Agent的Avro Sink成对存在。")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Exec")])]),t._v(" "),a("td",[t._v("Exec source通过执行给定的Unix命令的传输结果数据，如cat，tail -F等，实时性比较高，但是一旦Agent进程出现问题，可能会导致数据的丢失。")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Spooling Directory")])]),t._v(" "),a("td",[t._v("通过监控一个文件夹将新增文件内容转换成Event传输数据，特点是不会丢失数据，使用Spooling Directory Source需要注意的两点是: "),a("br"),t._v("1)不能对被监控的文件夹下的新增的文件做出任何更改"),a("br"),t._v("2）新增到监控文件夹的文件名称必须是唯一的。由于是对整个新增文件的监控，"),a("br"),t._v("Spooling Directory Source的实时性相对较低，不过可以采用对文件高粒度分割达到近似实时。")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Taildir")])]),t._v(" "),a("td",[t._v("可以实时的监控指定一个或多个文件中的新增内容，由于该方式将数据的偏移量保存在一个指定的json文件中，即使在Agent挂掉或被kill也不会有数据的丢失，需要注意的是，该Source不能在Windows上使用。")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("NetCat Source 参数详情")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channels@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定为：netcat")])]),t._v(" "),a("tr",[a("td",[t._v("bind@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("绑定机器名或IP地址")])]),t._v(" "),a("tr",[a("td",[t._v("port@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("端口号")])]),t._v(" "),a("tr",[a("td",[t._v("max-line-length")]),t._v(" "),a("td",[t._v("512")]),t._v(" "),a("td",[t._v("一行的最大字节数")])]),t._v(" "),a("tr",[a("td",[t._v("ack-every-event")]),t._v(" "),a("td",[t._v("true")]),t._v(" "),a("td",[t._v("对成功接受的Event返回OK")])]),t._v(" "),a("tr",[a("td",[t._v("selector.type")]),t._v(" "),a("td",[t._v("replicating")]),t._v(" "),a("td",[t._v("选择器类型replicating or multiplexing")])]),t._v(" "),a("tr",[a("td",[t._v("selector.*")]),t._v(" "),a("td",[t._v("选择器相关参数")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("interceptors")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("拦截器列表，多个以空格分隔")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors.*")]),t._v(" "),a("td",[t._v("拦截器相关参数")]),t._v(" "),a("td")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Avro Srource 参数详情")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channels@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定为：avro")])]),t._v(" "),a("tr",[a("td",[t._v("bind@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("监听的主机名或IP地址")])]),t._v(" "),a("tr",[a("td",[t._v("port@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("端口号")])]),t._v(" "),a("tr",[a("td",[t._v("threads")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("传输可使用的最大线程数")])]),t._v(" "),a("tr",[a("td",[t._v("selector.type")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("selector.*")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("interceptors")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("拦截器列表")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors.*")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("compression-type")]),t._v(" "),a("td",[t._v("none")]),t._v(" "),a("td",[t._v("可设置为“none” 或 “deflate”. 压缩类型需要和AvroSource匹配")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Exc Source 参数详情")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channels@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定为：exec")])]),t._v(" "),a("tr",[a("td",[t._v("command@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("需要去执行的命令")])]),t._v(" "),a("tr",[a("td",[t._v("shell")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("运行命令的shell脚本文件")])]),t._v(" "),a("tr",[a("td",[t._v("restartThrottle")]),t._v(" "),a("td",[t._v("10000")]),t._v(" "),a("td",[t._v("尝试重启的超时时间")])]),t._v(" "),a("tr",[a("td",[t._v("restart")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("如果命令执行失败，是否重启")])]),t._v(" "),a("tr",[a("td",[t._v("logStdErr")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否记录错误日志")])]),t._v(" "),a("tr",[a("td",[t._v("batchSize")]),t._v(" "),a("td",[t._v("20")]),t._v(" "),a("td",[t._v("批次写入channel的最大日志数量")])]),t._v(" "),a("tr",[a("td",[t._v("batchTimeout")]),t._v(" "),a("td",[t._v("3000")]),t._v(" "),a("td",[t._v("批次写入数据的最大等待时间（毫秒）")])]),t._v(" "),a("tr",[a("td",[t._v("selector.type")]),t._v(" "),a("td",[t._v("replicating")]),t._v(" "),a("td",[t._v("选择器类型replicating or multiplexing")])]),t._v(" "),a("tr",[a("td",[t._v("selector.*")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("选择器其他参数")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("拦截器列表，多个空格分隔")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors.*")]),t._v(" "),a("td"),t._v(" "),a("td")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Spooling Directory Source 参数详情")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channels@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定：spooldir.")])]),t._v(" "),a("tr",[a("td",[t._v("spoolDir@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("被监控的文件夹目录")])]),t._v(" "),a("tr",[a("td",[t._v("fileSuffix")]),t._v(" "),a("td",[t._v(".COMPLETED")]),t._v(" "),a("td",[t._v("完成数据传输的文件后缀标志")])]),t._v(" "),a("tr",[a("td",[t._v("deletePolicy")]),t._v(" "),a("td",[t._v("never")]),t._v(" "),a("td",[t._v("删除已经完成数据传输的文件时间：never or immediate")])]),t._v(" "),a("tr",[a("td",[t._v("fileHeader")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否在header中添加文件的完整路径信息")])]),t._v(" "),a("tr",[a("td",[t._v("fileHeaderKey")]),t._v(" "),a("td",[t._v("file")]),t._v(" "),a("td",[t._v("如果header中添加文件的完整路径信息时key的名称")])]),t._v(" "),a("tr",[a("td",[t._v("basenameHeader")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否在header中添加文件的基本名称信息")])]),t._v(" "),a("tr",[a("td",[t._v("basenameHeaderKey")]),t._v(" "),a("td",[t._v("basename")]),t._v(" "),a("td",[t._v("如果header中添加文件的基本名称信息时key的名称")])]),t._v(" "),a("tr",[a("td",[t._v("includePattern")]),t._v(" "),a("td",[t._v("^.*$")]),t._v(" "),a("td",[t._v("使用正则来匹配新增文件需要被传输数据的文件")])]),t._v(" "),a("tr",[a("td",[t._v("ignorePattern")]),t._v(" "),a("td",[t._v("^$")]),t._v(" "),a("td",[t._v("使用正则来忽略新增的文件")])]),t._v(" "),a("tr",[a("td",[t._v("trackerDir")]),t._v(" "),a("td",[t._v(".flumespool")]),t._v(" "),a("td",[t._v("存储元数据信息目录")])]),t._v(" "),a("tr",[a("td",[t._v("consumeOrder")]),t._v(" "),a("td",[t._v("oldest")]),t._v(" "),a("td",[t._v("文件消费顺序：oldest, youngest and random.")])]),t._v(" "),a("tr",[a("td",[t._v("maxBackoff")]),t._v(" "),a("td",[t._v("4000")]),t._v(" "),a("td",[t._v("如果channel容量不足，尝试写入的超时时间，如果仍然不能写入，则会抛出ChannelException")])]),t._v(" "),a("tr",[a("td",[t._v("batchSize")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("批次处理粒度")])]),t._v(" "),a("tr",[a("td",[t._v("inputCharset")]),t._v(" "),a("td",[t._v("UTF-8")]),t._v(" "),a("td",[t._v("输入码表格式")])]),t._v(" "),a("tr",[a("td",[t._v("decodeErrorPolicy")]),t._v(" "),a("td",[t._v("FAIL")]),t._v(" "),a("td",[t._v("遇到不可解码字符后的处理方式：FAIL，REPLACE，IGNORE")])]),t._v(" "),a("tr",[a("td",[t._v("selector.type")]),t._v(" "),a("td",[t._v("replicating")]),t._v(" "),a("td",[t._v("选择器类型：replicating or multiplexing")])]),t._v(" "),a("tr",[a("td",[t._v("selector.*")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("选择器其他参数")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("拦截器列表，空格分隔")])]),t._v(" "),a("tr",[a("td",[t._v("interceptors.*")]),t._v(" "),a("td"),t._v(" "),a("td")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Taildir  Source 参数详情")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channels@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("指定类型：TAILDIR.")])]),t._v(" "),a("tr",[a("td",[t._v("filegroups@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("文件组的名称，多个空格分隔")])]),t._v(" "),a("tr",[a("td",[t._v("filegroups.@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("被监控文件的绝对路径")])]),t._v(" "),a("tr",[a("td",[t._v("positionFile")]),t._v(" "),a("td",[t._v("~/.flume/taildir_position.json")]),t._v(" "),a("td",[t._v("存储数据偏移量路径")])]),t._v(" "),a("tr",[a("td",[t._v("headers..")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("Header key的名称")])]),t._v(" "),a("tr",[a("td",[t._v("byteOffsetHeader")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否添加字节偏移量到key为‘byteoffset’值中")])]),t._v(" "),a("tr",[a("td",[t._v("skipToEnd")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("当偏移量不能写入到文件时是否跳到文件结尾")])]),t._v(" "),a("tr",[a("td",[t._v("idleTimeout")]),t._v(" "),a("td",[t._v("120000")]),t._v(" "),a("td",[t._v("关闭没有新增内容的文件超时时间（毫秒）")])]),t._v(" "),a("tr",[a("td",[t._v("writePosInterval")]),t._v(" "),a("td",[t._v("3000")]),t._v(" "),a("td",[t._v("在positionfile 写入每一个文件lastposition的时间间隔")])]),t._v(" "),a("tr",[a("td",[t._v("batchSize")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("批次处理行数")])]),t._v(" "),a("tr",[a("td",[t._v("fileHeader")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否添加header存储文件绝对路径")])]),t._v(" "),a("tr",[a("td",[t._v("fileHeaderKey")]),t._v(" "),a("td",[t._v("file")]),t._v(" "),a("td",[t._v("fileHeader启用时，使用的key")])])])])]),t._v(" "),a("h3",{attrs:{id:"channels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#channels"}},[t._v("#")]),t._v(" Channels")]),t._v(" "),a("p",[t._v("官网提供的Channel有多种类型可供选择，这里介绍"),a("strong",[t._v("Memory Channel")]),t._v("和"),a("strong",[t._v("File Channel")]),t._v("。")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Memory Channel 参数详解")]),t._v(" "),a("p",[t._v("Memory Channel是使用内存来存储Event，使用内存的意味着数据传输速率会很快，但是当Agent挂掉后，存储在Channel中的数据将会丢失。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定为：memory")])]),t._v(" "),a("tr",[a("td",[t._v("capacity")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("存储在channel中的最大容量")])]),t._v(" "),a("tr",[a("td",[t._v("transactionCapacity")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("从一个source中去或者给一个sink，每个事务中最大的事件数")])]),t._v(" "),a("tr",[a("td",[t._v("keep-alive")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("对于添加或者删除一个事件的超时的秒钟")])]),t._v(" "),a("tr",[a("td",[t._v("byteCapacityBufferPercentage")]),t._v(" "),a("td",[t._v("20")]),t._v(" "),a("td",[t._v("定义缓存百分比")])]),t._v(" "),a("tr",[a("td",[t._v("byteCapacity")]),t._v(" "),a("td",[t._v("see description")]),t._v(" "),a("td",[t._v("Channel中允许存储的最大字节总数")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("File Channel 参数详解")]),t._v(" "),a("p",[t._v("File Channel使用磁盘来存储Event，速率相对于Memory Channel较慢，但数据不会丢失。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th"),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Property Name")]),t._v(" "),a("td",[t._v("Default")]),t._v(" "),a("td",[t._v("Description")])]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定：file.")])]),t._v(" "),a("tr",[a("td",[t._v("checkpointDir")]),t._v(" "),a("td",[t._v("~/.flume/file-channel/checkpoint")]),t._v(" "),a("td",[t._v("checkpoint目录")])]),t._v(" "),a("tr",[a("td",[t._v("useDualCheckpoints")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("备份checkpoint，为True，backupCheckpointDir必须设置")])]),t._v(" "),a("tr",[a("td",[t._v("backupCheckpointDir")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("备份checkpoint目录")])]),t._v(" "),a("tr",[a("td",[t._v("dataDirs")]),t._v(" "),a("td",[t._v("~/.flume/file-channel/data")]),t._v(" "),a("td",[t._v("数据存储所在的目录设置")])]),t._v(" "),a("tr",[a("td",[t._v("transactionCapacity")]),t._v(" "),a("td",[t._v("10000")]),t._v(" "),a("td",[t._v("Event存储最大值")])]),t._v(" "),a("tr",[a("td",[t._v("checkpointInterval")]),t._v(" "),a("td",[t._v("30000")]),t._v(" "),a("td",[t._v("checkpoint间隔时间")])]),t._v(" "),a("tr",[a("td",[t._v("maxFileSize")]),t._v(" "),a("td",[t._v("2146435071")]),t._v(" "),a("td",[t._v("单一日志最大设置字节数")])]),t._v(" "),a("tr",[a("td",[t._v("minimumRequiredSpace")]),t._v(" "),a("td",[t._v("524288000")]),t._v(" "),a("td",[t._v("最小的请求闲置空间（以字节为单位）")])]),t._v(" "),a("tr",[a("td",[t._v("capacity")]),t._v(" "),a("td",[t._v("1000000")]),t._v(" "),a("td",[t._v("Channel最大容量")])]),t._v(" "),a("tr",[a("td",[t._v("keep-alive")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("一个存放操作的等待时间值（秒）")])]),t._v(" "),a("tr",[a("td",[t._v("use-log-replay-v1")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("Expert: 使用老的回复逻辑")])]),t._v(" "),a("tr",[a("td",[t._v("use-fast-replay")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("Expert: 回复不需要队列")])]),t._v(" "),a("tr",[a("td",[t._v("checkpointOnClose")]),t._v(" "),a("td",[t._v("true")]),t._v(" "),a("td")])])])]),t._v(" "),a("h3",{attrs:{id:"sinks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sinks"}},[t._v("#")]),t._v(" Sinks")]),t._v(" "),a("p",[t._v("Flume常用Sinks有"),a("strong",[t._v("Log Sink，HDFS Sink，Avro Sink，Kafka Sink")]),t._v("，当然也可以自定义Sink。")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Log Sink")]),t._v(" "),a("p",[a("strong",[t._v("Logger Sink")]),t._v("：以INFO 级别的日志记录到log日志中，这种方式通常用于测试。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channel@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type＠")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("类型指定：logger")])]),t._v(" "),a("tr",[a("td",[t._v("maxBytesToLog")]),t._v(" "),a("td",[t._v("16")]),t._v(" "),a("td",[t._v("能够记录的最大Event Body字节数")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("HDFS Sink")]),t._v(" "),a("p",[a("strong",[t._v("HDFS Sink")]),t._v("：Sink数据到HDFS，目前支持text 和 sequence files两种文件格式，支持压缩，并可以对数据进行分区，分桶存储。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th"),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[t._v("Default")]),t._v(" "),a("td",[t._v("Description")])]),t._v(" "),a("tr",[a("td",[t._v("channel@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("指定类型：hdfs")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.path@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("HDFS的路径 hdfs://namenode/flume/webdata/")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.filePrefix")]),t._v(" "),a("td",[t._v("FlumeData")]),t._v(" "),a("td",[t._v("保存数据文件的前缀名")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.fileSuffix")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("保存数据文件的后缀名")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.inUsePrefix")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("临时写入的文件前缀名")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.inUseSuffix")]),t._v(" "),a("td",[t._v(".tmp")]),t._v(" "),a("td",[t._v("临时写入的文件后缀名")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.rollInterval")]),t._v(" "),a("td",[t._v("30")]),t._v(" "),a("td",[t._v("间隔多长将临时文件滚动成最终目标文件，单位：秒， 如果设置成0，则表示不根据时间来滚动文件")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.rollSize")]),t._v(" "),a("td",[t._v("1024")]),t._v(" "),a("td",[t._v("当临时文件达到多少（单位：bytes）时，滚动成目标文件， 如果设置成0，则表示不根据临时文件大小来滚动文件")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.rollCount")]),t._v(" "),a("td",[t._v("10")]),t._v(" "),a("td",[t._v("当 events 数据达到该数量时候，将临时文件滚动成目标文件，如果设置成0，则表示不根据events数据来滚动文件")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.idleTimeout")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("当目前被打开的临时文件在该参数指定的时间（秒）内， 没有任何数据写入，则将该临时文件关闭并重命名成目标文件")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.batchSize")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("每个批次刷新到 HDFS 上的 events 数量")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.codeC")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("文件压缩格式，包括：gzip, bzip2, lzo, lzop, snappy")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.fileType")]),t._v(" "),a("td",[t._v("SequenceFile")]),t._v(" "),a("td",[t._v("文件格式，包括：SequenceFile, DataStream,CompressedStre， 当使用DataStream时候，文件不会被压缩，不需要设置hdfs.codeC; 当使用CompressedStream时候，必须设置一个正确的hdfs.codeC值；")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.maxOpenFiles")]),t._v(" "),a("td",[t._v("5000")]),t._v(" "),a("td",[t._v("最大允许打开的HDFS文件数，当打开的文件数达到该值，最早打开的文件将会被关闭")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.minBlockReplicas")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("HDFS副本数，写入 HDFS 文件块的最小副本数。 该参数会影响文件的滚动配置，一般将该参数配置成1，才可以按照配置正确滚动文件")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.writeFormat")]),t._v(" "),a("td",[t._v("Writable")]),t._v(" "),a("td",[t._v("写 sequence 文件的格式。包含：Text, Writable（默认）")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.callTimeout")]),t._v(" "),a("td",[t._v("10000")]),t._v(" "),a("td",[t._v("执行HDFS操作的超时时间（单位：毫秒）")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.threadsPoolSize")]),t._v(" "),a("td",[t._v("10")]),t._v(" "),a("td",[t._v("hdfs sink 启动的操作HDFS的线程数")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.rollTimerPoolSize")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("hdfs sink 启动的根据时间滚动文件的线程数")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.kerberosPrincipal")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("HDFS安全认证kerberos配置")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.kerberosKeytab")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("HDFS安全认证kerberos配置")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.proxyUser")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("代理用户")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.round")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否启用时间上的”舍弃”")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.roundValue")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("时间上进行“舍弃”的值")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.roundUnit")]),t._v(" "),a("td",[t._v("second")]),t._v(" "),a("td",[t._v("时间上进行”舍弃”的单位，包含：second,minute,hour")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.timeZone")]),t._v(" "),a("td",[t._v("Local Time")]),t._v(" "),a("td",[t._v("时区。")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.useLocalTimeStamp")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("是否使用当地时间")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.closeTries 0")]),t._v(" "),a("td",[t._v("Number")]),t._v(" "),a("td",[t._v("hdfs sink 关闭文件的尝试次数；如果设置为1，当一次关闭文件失败后，hdfs sink将不会再次尝试关闭文件， 这个未关闭的文件将会一直留在那，并且是打开状态； 设置为0，当一次关闭失败后，hdfs sink会继续尝试下一次关闭，直到成功")])]),t._v(" "),a("tr",[a("td",[t._v("hdfs.retryInterval")]),t._v(" "),a("td",[t._v("180")]),t._v(" "),a("td",[t._v("hdfs sink 尝试关闭文件的时间间隔， 如果设置为0，表示不尝试，相当于于将hdfs.closeTries设置成1")])]),t._v(" "),a("tr",[a("td",[t._v("serializer")]),t._v(" "),a("td",[t._v("TEXT")]),t._v(" "),a("td",[t._v("序列化类型")])]),t._v(" "),a("tr",[a("td",[t._v("serializer.*")]),t._v(" "),a("td"),t._v(" "),a("td")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Avro Sink")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("channel@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("type@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("指定类型：avro.")])]),t._v(" "),a("tr",[a("td",[t._v("hostname@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("主机名或IP")])]),t._v(" "),a("tr",[a("td",[t._v("port@")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("端口号")])]),t._v(" "),a("tr",[a("td",[t._v("batch-size")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("批次处理Event数")])]),t._v(" "),a("tr",[a("td",[t._v("connect-timeout 20000")]),t._v(" "),a("td",[t._v("连接超时时间")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("request-timeout")]),t._v(" "),a("td",[t._v("20000")]),t._v(" "),a("td",[t._v("请求超时时间")])]),t._v(" "),a("tr",[a("td",[t._v("compression-type")]),t._v(" "),a("td",[t._v("none")]),t._v(" "),a("td",[t._v("压缩类型，“none” or “deflate”.")])]),t._v(" "),a("tr",[a("td",[t._v("compression-level")]),t._v(" "),a("td",[t._v("6")]),t._v(" "),a("td",[t._v("压缩级别，0表示不压缩，1-9数字越大，压缩比越高")])]),t._v(" "),a("tr",[a("td",[t._v("ssl")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("使用ssl加密")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("kafka Sink")]),t._v(" "),a("p",[t._v("传输数据到Kafka中，需要注意的是Flume版本和Kafka版本的兼容性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property Name")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("type")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("指定类型："),a("strong",[t._v("org.apache.flume.sink.kafka.KafkaSink")])])]),t._v(" "),a("tr",[a("td",[t._v("kafka.bootstrap.servers")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("kafka服务地址   "),a("strong",[t._v("localhost:9092")])])]),t._v(" "),a("tr",[a("td",[t._v("kafka.topic")]),t._v(" "),a("td",[t._v("default-flume-topic")]),t._v(" "),a("td",[t._v("kafka Topic")])]),t._v(" "),a("tr",[a("td",[t._v("flumeBatchSize")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("批次写入kafka Event数")])])])])]),t._v(" "),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试：")]),t._v(" "),a("h3",{attrs:{id:"_1-监控444444端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-监控444444端口"}},[t._v("#")]),t._v(" 1. 监控444444端口")]),t._v(" "),a("p",[t._v("复制一份"),a("code",[t._v("flume-conf.propertise.template")]),t._v("改名为"),a("code",[t._v("demo.propertise")])]),t._v(" "),a("p",[t._v("修改文件内容为：")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# example.conf: A single-node Flume configuration")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Name the components on this agent")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("r1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sinks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("k1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Describe/configure the source")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.r1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("netcat")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.r1.bind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("localhost")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.r1.port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("44444")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Describe the sink")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sinks.k1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("logger")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Use a channel which buffers events in memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.channels.c1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.channels.c1.capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.channels.c1.transactionCapacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bind the source and sink to the channel")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.r1.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sinks.k1.channel")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("命令行输入一下文本，用于监听44444端口的信息，格式可以看之前的指令介绍")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("flume-ng agent --name a1 --conf "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf --conf-file "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FLUME_HOME")]),t._v("/conf/demo.properties -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("INFO,console\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("新开一个终端窗口，telnet localhost 44444端口，输入信息，即可在之前的控制台看到监控到的打印信息")]),t._v(" "),a("p",[a("img",{attrs:{src:_(543),alt:"image-20200823124829699"}})]),t._v(" "),a("p",[a("img",{attrs:{src:_(544),alt:"image-20200823125022747"}})]),t._v(" "),a("h3",{attrs:{id:"_2-监控日志文本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-监控日志文本"}},[t._v("#")]),t._v(" 2. 监控日志文本")]),t._v(" "),a("p",[t._v("只需要conf配置文件中的配置改一下即可，参考前面的 "),a("strong",[t._v("source")]),t._v("配置，修改以下几行：")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.s1.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("exec")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取数据来源的地方设为日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.s1.command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tail -F /opt/app/applog/kafka.log")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("a1.sources.s1.channels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("用之前的启动命令，如果是新建立的一个配置文件，启动命令对应修改即可。启动后在"),a("code",[t._v("kafka.log")]),t._v("中输入数据，控制台会做出相应的打印。")]),t._v(" "),a("h3",{attrs:{id:"_3-flume-kafka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-flume-kafka"}},[t._v("#")]),t._v(" 3. flume+kafka")]),t._v(" "),a("p",[t._v("主要模拟流程，flume获取"),a("code",[t._v("kafka.log")]),t._v("s数据，发送到kafka")]),t._v(" "),a("p",[t._v("新建一个"),a("code",[t._v("kafkap.properties")]),t._v("文件，内容如下：主要是修改了"),a("code",[t._v("sink")]),t._v("的相关配置，将数据传送到kafka去")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sources")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("s1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("k1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sources")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sources.s1.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("exec")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sources.s1.command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tail -F /opt/app/applog/kafka.log")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sources.s1.channels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# channels")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.channels.c1.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.channels.c1.capacity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.channels.c1.transactionCapacity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sinks")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks.k1.type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("org.apache.flume.sink.kafka.KafkaSink")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks.k1.brokerList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1:9092")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks.k1.topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("kafkatest")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks.k1.serializer.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("kafka.serializer.StringEncoder")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("agent.sinks.k1.channel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("c1")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("ul",[a("li",[t._v("启动"),a("code",[t._v("zookeeper")]),t._v("，jps后台进程显示为"),a("code",[t._v("QuorumPeerMain")]),t._v("即成功")])]),t._v(" "),a("blockquote",[a("p",[t._v("nohup bin/zookeeper-server-start.sh config/zk.properties &")])]),t._v(" "),a("ul",[a("li",[t._v("启动"),a("code",[t._v("kafka")]),t._v("，jps后台进程显示为"),a("code",[t._v("kafka")]),t._v("及成功")])]),t._v(" "),a("blockquote",[a("p",[t._v("nohup bin/kafka-server-start.sh config/kafka1.properties &")])]),t._v(" "),a("ul",[a("li",[t._v("创建一个topic为"),a("code",[t._v("kafkatest")]),t._v("的消费者")])]),t._v(" "),a("blockquote",[a("p",[t._v("bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic kafkatest --from-beginning")])]),t._v(" "),a("ul",[a("li",[t._v("启动"),a("code",[t._v("flume")])])]),t._v(" "),a("blockquote",[a("p",[t._v("flume-ng agent --name agent --conf $FLUME_HOME/conf --conf-file $FLUME_HOME/conf/kafka.properties")])]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("kafka.log")]),t._v("文件中写入输入，即可看到"),a("code",[t._v("kafkatest")]),t._v("终端的消费")]),t._v(" "),a("h3",{attrs:{id:"_4-flume-kafka-spark-inflxdb-grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-flume-kafka-spark-inflxdb-grafana"}},[t._v("#")]),t._v(" 4. flume+kafka+spark+inflxdb+grafana")]),t._v(" "),a("blockquote",[a("p",[t._v("启动zookeeper")]),t._v(" "),a("p",[t._v("启动kafka")]),t._v(" "),a("p",[t._v("启动flume")]),t._v(" "),a("p",[t._v("启动sparkt")]),t._v(" "),a("p",[t._v("提交spark作业")]),t._v(" "),a("p",[t._v("grafana配置inflxdb")]),t._v(" "),a("p",[t._v("监控面板从influxdb中获取数据实时显示")])])])}),[],!1,null,null,null);v.default=e.exports}}]);