(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{623:function(e,s,n){"use strict";n.r(s);var a=n(3),t=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[s("strong",[e._v("Dockerfile")]),e._v("是一个包含用于组合映像的命令的文本文档。可以使用在命令行中调用任何命令。 Docker通过读取"),s("code",[e._v("Dockerfile")]),e._v("中的指令自动生成映像。")])]),e._v(" "),s("h2",{attrs:{id:"概要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[e._v("#")]),e._v(" 概要")]),e._v(" "),s("p",[s("strong",[e._v("相关链接：")])]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 官网"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/docker/docker-ce",target:"_blank",rel:"noopener noreferrer"}},[e._v("Github Docker 源码"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/cli/?spm=5176.8351553.0.0.4f441991dVcHxY",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker官网命令文档"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"http://www.dockerinfo.net/document",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker中文文档"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-compose.yaml 官方说明"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://yeasy.gitbook.io/docker_practice/os/alpine",target:"_blank",rel:"noopener noreferrer"}},[e._v("Alpine"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云镜像容器"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("strong",[e._v("简述：")])]),e._v(" "),s("p",[e._v("最开始我们启动一个docker容器，拉取镜像，然后通过 "),s("code",[e._v("run")]),e._v(" 命令，指定一些参数（暴露端口，环境变量，容器名称，挂载路径等）来启动容器，比较麻烦，且不容易记住那些携带的参数指令；后面引入Dockerfile，通过文件的形式，构建自己的镜像，通过docker build, run等命令操作容器；但如果是docker启动了一个微服务架构的业务，有很多个容器，每个容器都需要手动启停，就显得特别繁琐。docker-compose用于高效管理这些容器，是用于定义和运行多容器的工具")]),e._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-compose 项目地址"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("直接下载最新稳定版"),s("code",[e._v('sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose')]),e._v("，添加到"),s("code",[e._v("/user/local/bin")]),e._v("，添加可执行权限"),s("code",[e._v("sudo chmod +x /usr/local/bin/docker-compose")])]),e._v(" "),s("p",[e._v("也可以通过"),s("code",[e._v("yum")]),e._v("、"),s("code",[e._v("apt")]),e._v("等直接搜索安装，")]),e._v(" "),s("p",[s("strong",[e._v("验证")]),e._v("："),s("code",[e._v("docker-compose --version")])]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://raw.githubusercontent.com/docker/compose",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-compose命令补全工具"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("直接下载，根据项目选择最新的版本号即可："),s("code",[e._v("sudo curl -L https://raw.githubusercontent.com/docker/compose/1.27.4/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose")])]),e._v(" "),s("p",[e._v("重启即可生效")]),e._v(" "),s("h2",{attrs:{id:"基本结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本结构"}},[e._v("#")]),e._v(" 基本结构")]),e._v(" "),s("p",[e._v("一般分为四部分，第一条指令必须是"),s("code",[e._v("FROM")]),e._v("。一个声明以"),s("code",[e._v("＃")]),e._v("字符开头则被视为注释。可以在Docker文件中使用"),s("code",[e._v("RUN")]),e._v("，"),s("code",[e._v("CMD")]),e._v("，"),s("code",[e._v("FROM")]),e._v("，"),s("code",[e._v("EXPOSE")]),e._v("，"),s("code",[e._v("ENV")]),e._v("等指令。")]),e._v(" "),s("ul",[s("li",[e._v("service：服务模块，可多个")]),e._v(" "),s("li",[e._v("networks：网络模块，负责多个容器之间的项目通信")]),e._v(" "),s("li",[e._v("镜像操作指令")]),e._v(" "),s("li",[e._v("容器启动时执行指令")])]),e._v(" "),s("h2",{attrs:{id:"常用指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用指令"}},[e._v("#")]),e._v(" 常用指令")]),e._v(" "),s("p",[e._v("常用指令通过"),s("code",[e._v("docker-compose --help")]),e._v("查看介绍，docker-compose 指令以 "),s("code",[e._v("docker-compose")]),e._v("开头，大部分指令和docker保持一致")]),e._v(" "),s("p",[e._v("注意：下面格式中的"),s("code",[e._v("nginx")]),e._v("代表参数为 服务名，要对哪个服务做对应的操作")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("指令")]),e._v(" "),s("th",[e._v("格式")]),e._v(" "),s("th",[e._v("说明")]),e._v(" "),s("th",[e._v("备注")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[e._v("up")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose up -d .yaml文件")])]),e._v(" "),s("td",[e._v("构建、启动容器")]),e._v(" "),s("td",[e._v("-d：标识后台运行")])]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("build")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose build .yaml文件")])]),e._v(" "),s("td",[e._v("构建或重新构建容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("exec")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose exec nginx bash")])]),e._v(" "),s("td",[e._v("进入到容器中")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("ps")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose ps")])]),e._v(" "),s("td",[e._v("查看运行的容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("logs")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose logs -f nginx")])]),e._v(" "),s("td",[e._v("查看日志")]),e._v(" "),s("td",[e._v("-f : 滚动查看日志")])]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("config")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose config -q")])]),e._v(" "),s("td",[e._v("检查"),s("code",[e._v("docker-compose.yaml")]),e._v("语法是否正确")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("rm")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose rm nginx")])]),e._v(" "),s("td",[e._v("删除容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("start")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose start nginx")])]),e._v(" "),s("td",[e._v("启动容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("stop")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose stop nginx")])]),e._v(" "),s("td",[e._v("停止容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("restart")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose restart nginx")])]),e._v(" "),s("td",[e._v("重启容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("kill")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose kill nignx")])]),e._v(" "),s("td",[e._v("通过发送 SIGKILL 信号来停止指定服务的容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("pause")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose pause nginx")])]),e._v(" "),s("td",[e._v("暂停容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",[s("strong",[e._v("unpause")])]),e._v(" "),s("td",[s("code",[e._v("docker-compose unpause nginx")])]),e._v(" "),s("td",[e._v("恢复容器")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td"),e._v(" "),s("td"),e._v(" "),s("td"),e._v(" "),s("td")])])]),e._v(" "),s("h2",{attrs:{id:"docker-compose-yaml语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yaml语法"}},[e._v("#")]),e._v(" docker-compose.yaml语法")]),e._v(" "),s("h3",{attrs:{id:"version"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#version"}},[e._v("#")]),e._v(" "),s("strong",[e._v("version")]),e._v("：")]),e._v(" "),s("p",[e._v("指定 "),s("code",[e._v("docker-compose.yml")]),e._v(" 文件的写法格式")]),e._v(" "),s("h3",{attrs:{id:"services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#services"}},[e._v("#")]),e._v(" "),s("strong",[e._v("services")]),e._v("：")]),e._v(" "),s("p",[e._v("多个容器集合")]),e._v(" "),s("h3",{attrs:{id:"build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[e._v("#")]),e._v(" "),s("strong",[e._v("build")]),e._v("：")]),e._v(" "),s("p",[e._v("配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("build: ./dir\n---------------\nbuild:\n    context: ./dir\n    dockerfile: Dockerfile\n    args:\n        buildno: 1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("h3",{attrs:{id:"command"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#command"}},[e._v("#")]),e._v(" "),s("strong",[e._v("command")]),e._v("：")]),e._v(" "),s("p",[e._v("覆盖容器启动后默认执行的命令")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("command: bundle exec thin -p 3000\n----------------------------------\ncommand: [bundle,exec,thin,-p,3000]\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#image"}},[e._v("#")]),e._v(" "),s("strong",[e._v("image")]),e._v("：")]),e._v(" "),s("p",[e._v("指定服务所使用的镜像")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("image: java\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"expose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[e._v("#")]),e._v(" expose")]),e._v(" "),s("p",[e._v("暴露端口，但不映射到宿主机，只被连接的服务访问，仅可以指定内部端口为参数")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v('expose:\n- "3000"\n- "8000"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"ports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ports"}},[e._v("#")]),e._v(" "),s("strong",[e._v("ports")]),e._v("：")]),e._v(" "),s("p",[e._v("对外暴露的端口定义，和 expose 对应")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v('ports:   # 暴露端口信息  - "宿主机端口:容器暴露端口"\n- "8763:8763"\n- "8763:8763"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#environment"}},[e._v("#")]),e._v(" "),s("strong",[e._v("environment")]),e._v("：")]),e._v(" "),s("p",[e._v("环境变量设置，可使用数组或字典两种方式")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("environment:\n  RACK_ENV: development\n  SHOW: 'true'\n  SESSION_SECRET:\n\nenvironment:\n  - RACK_ENV=development\n  - SHOW=true\n  - SESSION_SECRET\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h3",{attrs:{id:"depends-on"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#depends-on"}},[e._v("#")]),e._v(" "),s("strong",[e._v("depends_on")])]),e._v(" "),s("p",[e._v("服务之前的依赖关系，启动服务时，会先启动被依赖的服务")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("web:\n  depends_on:\n    - redis\n    - mysql\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h3",{attrs:{id:"networks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#networks"}},[e._v("#")]),e._v(" "),s("strong",[e._v("networks")]),e._v("：")]),e._v(" "),s("p",[e._v("网络模块，可以用于指定服务使用的网络，使用共同网络的容器可以相互通信")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v('networks:\n   my_network:\n      - "bridge"\n'),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# host\t\t主机模式，与宿主机共享网络，使用宿主机的ip和端口")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# bridge\t桥接模式，分配独立的ip，容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# none \t\t孤岛模式，该模式关闭了容器的网络功能")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# container 和一个指定的容器共享IP")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("h3",{attrs:{id:"links"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[e._v("#")]),e._v(" "),s("strong",[e._v("links")]),e._v("：")]),e._v(" "),s("p",[e._v("连接到其他服务的容器")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("web:\n  links:\n   - db\t\t\t\t# 服务名\n   - db:database\t# 服务名: 别名\n   - redis\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"external-links"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#external-links"}},[e._v("#")]),e._v(" "),s("strong",[e._v("external_links")]),e._v("：")]),e._v(" "),s("p",[e._v("连接到"),s("code",[e._v("docker-compose.yml")]),e._v("外部的容器，甚至并非Compose管理的容器，特别是提供共享或公共服务的容器。格式跟links类似")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("external_links:\n - redis_1\n - project_db_1:mysql\t\t# 服务名:别名\n - project_db_1:postgresql\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h3",{attrs:{id:"volumes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[e._v("#")]),e._v(" volumes")]),e._v(" "),s("p",[e._v("卷挂载路径设置。可以设置宿主机路径 （"),s("code",[e._v("HOST:CONTAINER")]),e._v("） ，也可指定访问模式 （"),s("code",[e._v("HOST:CONTAINER:ro")]),e._v("），只读（ro），读写（rw），读写（rw）")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("volumes:\n  - /var/lib/mysql\t\t\t\t\t# 指令容器内的一个路径，让容器创建\n  - /opt/data:/var/lib/mysql\t\t# 宿主机路径：容器路径\n  - ./cache:/tmp/cache\t\t\t\t# 相对于docker-compose.yml路径的宿主机路径：容器路径\n  - ~/configs:/etc/configs/:ro\t\t# 相对应当前用户的宿主机路径：容器路径：读写权限\n  - datavolume:/var/lib/mysql\t\t# 指定一个存在的卷\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h3",{attrs:{id:"env-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#env-file"}},[e._v("#")]),e._v(" "),s("strong",[e._v("env_file")]),e._v("：")]),e._v(" "),s("p",[e._v("从文件中获取环境变量，可指定一个文件路径或路径列表")]),e._v(" "),s("p",[e._v("如果通过 "),s("code",[e._v("docker-compose -f FILE")]),e._v(" 指定了Compose文件，那么env_file中的路径是Compose文件所在目录的相对路径。使用environment指定的环境变量会覆盖env_file指定的环境变量")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("env_file: .env\n--------------------------------\nenv_file:\n  - ./common.env\t\t\t# 共用\n  - ./apps/web.env\t\t\t# web用\n  - /opt/secrets.env\t\t# 密码用\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h3",{attrs:{id:"volumes-from"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volumes-from"}},[e._v("#")]),e._v(" volumes_from")]),e._v(" "),s("p",[e._v("从另一个服务或容器挂载卷。可指定只读（ro）或读写（rw），默认是读写（rw）")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("volumes_from:\n - service_name\n - service_name:ro\n - container:container_name\n - container:container_name:rw\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[s("strong",[e._v("dns")])]),e._v(" "),s("p",[e._v("配置dns服务器。可以是一个值，也可以是一个列表")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("dns: 8.8.8.8\ndns:\n  - 8.8.8.8\n  - 9.9.9.9\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h3",{attrs:{id:"dns-search"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dns-search"}},[e._v("#")]),e._v(" dns_search")]),e._v(" "),s("p",[e._v("配置DNS的搜索域名，可以是一个值，也可以是一个列表")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[e._v("dns_search: example.com\ndns_search:\n  - dc1.example.com\n  - dc2.example.com\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h3",{attrs:{id:"extends"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extends"}},[e._v("#")]),e._v(" extends")]),e._v(" "),s("p",[e._v("基于已有的服务进行扩展。例如我们已经有了一个 webapp 服务，模板文件为"),s("code",[e._v("common.yml")]),e._v("，"),s("code",[e._v("development.yml")]),e._v("能继承"),s("code",[e._v("common.yml")]),e._v("中的所有服务和环境变量")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# common.yml")]),e._v("\nwebapp:\nbuild: ./webapp\nenvironment:\n - DEBUG=false\n - SEND_EMAILS=false\n \n---------------------\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# development.yml")]),e._v('\nweb:\nextends:\nfile: common.yml\nservice: webapp\nports:\n - "8000:8000"\nlinks:\n - db\nenvironment:\n- DEBUG=true\ndb:\nimage: postgres\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br")])]),s("h2",{attrs:{id:"其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[e._v("#")]),e._v(" 其他")]),e._v(" "),s("p",[e._v("更新容器：")]),e._v(" "),s("ul",[s("li",[e._v("当配置文件变更时，"),s("code",[e._v("docker-compose up")]),e._v("更新容器")]),e._v(" "),s("li",[e._v("会删除旧容器，创建新容器，生成新的ip，所有指向旧容器的连接会关闭，重新指向新容器")])])])}),[],!1,null,null,null);s.default=t.exports}}]);