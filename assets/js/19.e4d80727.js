(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{648:function(s,t,a){s.exports=a.p+"assets/img/image-20210901165641559.7c1b08e1.png"},649:function(s,t){s.exports="data:image/png;base64,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"},650:function(s,t,a){s.exports=a.p+"assets/img/image-20210901121439658.864c0035.png"},651:function(s,t,a){s.exports=a.p+"assets/img/image-20210901122110985.23481d15.png"},836:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("Spring Cloud Security 为构建安全的SpringBoot应用提供了一系列解决方案，结合Oauth2可以实现单点登录、令牌中继、令牌交换等功能，"),n("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考阮一峰"),n("OutboundLink")],1)])]),s._v(" "),n("h1",{attrs:{id:"概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),n("h2",{attrs:{id:"oauth2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#oauth2"}},[s._v("#")]),s._v(" Oauth2")]),s._v(" "),n("p",[s._v("OAuth（开放授权）是一个开放标准，允许用户授权第三方移动应用访问他们存储在另外的服务提供者上的信息，而不需要将用户名和密码提供给第三方移动应用或分享他们数据的所有内容，OAuth2.0是OAuth协议的延续版本，但不向后兼容OAuth 1.0即完全废止了OAuth1.0。")]),s._v(" "),n("p",[s._v("场景：第三方QQ、微信、支付宝授权登录")]),s._v(" "),n("h2",{attrs:{id:"相关名词"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关名词"}},[s._v("#")]),s._v(" 相关名词")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Resource owner")]),s._v("（资源拥有者："),n("code",[s._v("登陆用户")]),s._v("）：拥有该资源的最终用户，他有访问资源的账号密码；")]),s._v(" "),n("li",[n("strong",[s._v("Resource server")]),s._v("（资源服务器）：拥有受保护资源的服务器，如果请求包含正确的访问令牌，可以访问资源；")]),s._v(" "),n("li",[n("strong",[s._v("Client")]),s._v("（客户端："),n("code",[s._v("使用第三方账号授权登陆的app、web等应用")]),s._v("）：访问资源的客户端，会使用访问令牌去获取资源服务器的资源，可以是浏览器、移动设备或者服务器；")]),s._v(" "),n("li",[n("strong",[s._v("Authorization server")]),s._v("（认证服务器）：用于认证用户的服务器，如果客户端认证通过，发放访问资源服务器的令牌。")])]),s._v(" "),n("h1",{attrs:{id:"授权模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权模式"}},[s._v("#")]),s._v(" 授权模式")]),s._v(" "),n("ul",[n("li",[s._v("授权码模式（authorization code）（常用）：正宗的OAuth2的授权模式，客户端先将用户导向认证服务器，登录后获取授权码，然后进行授权，最后根据授权码获取访问令牌")]),s._v(" "),n("li",[s._v("密码模式（resource owner password credentials）（常用）：和授权码模式相比，取消了获取授权码的过程，直接获取访问令牌")]),s._v(" "),n("li",[s._v("简化模式（implicit）：客户端直接向用户获取用户名和密码，之后向认证服务器获取访问令牌")]),s._v(" "),n("li",[s._v("客户端模式（client credentials）：客户端直接通过客户端认证（比如client_id和client_secret）从认证服务器获取访问令牌")])]),s._v(" "),n("h2",{attrs:{id:"授权码模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权码模式"}},[s._v("#")]),s._v(" 授权码模式")]),s._v(" "),n("ul",[n("li",[s._v("（A）用户打开客户端以后，客户端要求用户给予授权（前端，携带回调地址，跳转三方登陆或者弹出窗口，要求授权）")]),s._v(" "),n("li",[s._v("（B）用户同意给予客户端授权（前端，用户密码登陆或者扫码确定授权）")]),s._v(" "),n("li",[s._v("（C）客户端使用上一步获得的授权，向认证服务器申请令牌（后端，携带授权码申请令牌）")]),s._v(" "),n("li",[s._v("（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌，有需要带上刷新令牌（后端，认证通过，返回令牌）")]),s._v(" "),n("li",[s._v("（E）客户端使用令牌，向资源服务器申请获取资源（后端，卸载令牌，访问资源，登陆）")]),s._v(" "),n("li",[s._v("（F）资源服务器确认令牌无误，同意向客户端开放资源（前端，登陆成功，访问具体资源）")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(648),alt:"image-20210901165641559"}})]),s._v(" "),n("h3",{attrs:{id:"实例分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实例分析"}},[s._v("#")]),s._v(" 实例分析：")]),s._v(" "),n("p",[s._v("用户登陆A.com，需要三方授权，跳转到B.com，授权成功，跳转回来，登陆成功")]),s._v(" "),n("p",[s._v("A，获取授权码，用户登陆 A.com，选用三方登陆，前端进行弹出窗口或这跳转链接到 B.com 要求用户登陆，发起的请求链接如下：")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oauth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("authorize"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("response_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  client_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  redirect_uri"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CALLBACK_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  scope"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("read\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("参数说明")]),s._v(" "),n("p",[s._v("上面 URL 中，")]),s._v(" "),n("p",[n("code",[s._v("response_type")]),s._v("参数表示要求返回授权码（"),n("code",[s._v("code")]),s._v("）")]),s._v(" "),n("p",[n("code",[s._v("client_id")]),s._v("参数让 B 知道是谁在请求，")]),s._v(" "),n("p",[n("code",[s._v("redirect_uri")]),s._v("参数是 B 接受或拒绝请求后的跳转网址")]),s._v(" "),n("p",[n("code",[s._v("scope")]),s._v("参数表示要求的授权范围（这里是只读）")])]),s._v(" "),n("p",[s._v("B，用户输入密码，或者扫码成功后，确认授权登陆，返回下面信息，"),n("code",[s._v("callback")]),s._v("是之前设置的回调地址，"),n("code",[s._v("code")]),s._v("参数就是授权码")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AUTHORIZATION_CODE")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("C，后端拿着这个授权码，向认证服务器申请令牌")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oauth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n\tclient_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\tclient_secret"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT_SECRET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\tgrant_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("authorization_code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\tcode"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AUTHORIZATION_CODE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\tredirect_uri"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CALLBACK_URL")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("参数说明")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("# 上面 URL 中，\n\n`client_id`参数和`client_secret`参数用来让 B 确认 A 的身份（`client_secret`参数是保密的，因此只能在后端发请求），\n`grant_type`参数的值是`AUTHORIZATION_CODE`，表示采用的授权方式是授权码，\n`code`参数是上一步拿到的授权码，\n`redirect_uri`参数是令牌颁发后的回调网址。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])]),s._v(" "),n("p",[s._v("D，认证服务器返回令牌")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    \n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"access_token"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ACCESS_TOKEN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"token_type"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bearer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"expires_in"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2592000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"refresh_token"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REFRESH_TOKEN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scope"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"uid"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"info"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("..."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("E，客户端拿到令牌后，携带令牌访问用户资源，即登陆成功")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("https://a.com/xxx\nheader中添加 Authorization Bearer 396465c0-ef6e-4c0d-8b76-b43ac2b6f715\nBearer 后面的即为之前拿到的令牌\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"密码模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#密码模式"}},[s._v("#")]),s._v(" 密码模式")]),s._v(" "),n("ul",[n("li",[s._v("(A)客户端从用户获取用户名和密码")]),s._v(" "),n("li",[s._v("(B)客户端通过用户的用户名和密码访问认证服务器")]),s._v(" "),n("li",[s._v("(C)认证服务器返回访问令牌（有需要带上刷新令牌）")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(649),alt:"image-20210901121253902"}})]),s._v(" "),n("p",[s._v("这个相比之前的授权码模式，简化了获取授权码的步骤，直接是客户端拿到用户的用户名和密码，直接向认证服务器申请令牌，"),n("code",[s._v("grant_type")]),s._v("的值为"),n("code",[s._v("password")]),s._v("，请求如下：")]),s._v(" "),n("p",[s._v("这种方式风险很大，因此只适用于其他授权方式都无法采用的情况，而且必须是用户高度信任的应用")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oauth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n  grant_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  username"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USERNAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  client_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT_ID")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"简化模式-未尝试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简化模式-未尝试"}},[s._v("#")]),s._v(" 简化模式（未尝试）")]),s._v(" "),n("p",[s._v('简化模式（implicit grant type）不通过第三方应用程序的服务器，直接在浏览器中向认证服务器申请令牌，跳过了"授权码"这个步骤，因此得名。所有步骤在浏览器中完成，令牌对访问者是可见的，且客户端不需要认证，')]),s._v(" "),n("p",[s._v("这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间（session）有效，浏览器关掉，令牌就失效了")]),s._v(" "),n("ul",[n("li",[s._v("（A）客户端将用户导向认证服务器")]),s._v(" "),n("li",[s._v("（B）用户决定是否给于客户端授权")]),s._v(" "),n("li",[s._v('（C）假设用户给予授权，认证服务器将用户导向客户端指定的"重定向URI"，并在URI的Hash部分包含了访问令牌。')]),s._v(" "),n("li",[s._v("（D）浏览器向资源服务器发出请求，其中不包括上一步收到的Hash值")]),s._v(" "),n("li",[s._v("（E）资源服务器返回一个网页，其中包含的代码可以获取Hash值中的令牌")]),s._v(" "),n("li",[s._v("（F）浏览器执行上一步获得的脚本，提取出令牌")]),s._v(" "),n("li",[s._v("（G）浏览器将令牌发给客户端")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(650),alt:"image-20210901121439658"}})]),s._v(" "),n("h2",{attrs:{id:"客户端模式-未尝试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端模式-未尝试"}},[s._v("#")]),s._v(" 客户端模式（未尝试）")]),s._v(" "),n("ul",[n("li",[s._v("（A）客户端向认证服务器进行身份认证，并要求一个访问令牌。")]),s._v(" "),n("li",[s._v("（B）认证服务器确认无误后，向客户端提供访问令牌。")])]),s._v(" "),n("p",[s._v("注意：")]),s._v(" "),n("p",[s._v("A步骤中，客户端发出的HTTP请求，包含以下参数：")]),s._v(" "),n("ul",[n("li",[s._v('granttype：表示授权类型，此处的值固定为"clientcredentials"，必选项。')]),s._v(" "),n("li",[s._v("scope：表示权限范围，可选项")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(651),alt:"image-20210901122110985"}})]),s._v(" "),n("h1",{attrs:{id:"创建oauth2-server模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建oauth2-server模块"}},[s._v("#")]),s._v(" 创建Oauth2-server模块")]),s._v(" "),n("p",[s._v("作用：模拟资源服务器，认证服务器，接口调用")]),s._v(" "),n("ul",[n("li",[s._v("pom依赖")])]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-oauth2"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-security"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-web"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("application-yml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9401")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" oauth2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("添加UserService实现UserDetailsService接口，用于加载用户信息")])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("初始化一些用户信息")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetailsService")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" userList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" passwordEncoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PostConstruct")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" passwordEncoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        userList "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        userList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"macro"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("commaSeparatedStringToAuthorityList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        userList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"andy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("commaSeparatedStringToAuthorityList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        userList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mark"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("commaSeparatedStringToAuthorityList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetails")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadUserByUsername")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernameNotFoundException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" findUserList "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUsername")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("collect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collectors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("toList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CollectionUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("findUserList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" findUserList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernameNotFoundException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名或密码错误"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])]),s._v(" "),n("ul",[n("li",[s._v("添加"),n("code",[s._v("认证服务器配置")]),s._v("，使用"),n("code",[s._v("@EnableAuthorizationServer")]),s._v("注解开启")])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("模拟认证服务器配置")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableAuthorizationServer")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorizationServerConfig")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorizationServerConfigurerAdapter")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" passwordEncoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationManager")]),s._v(" authenticationManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" userService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 使用密码模式需要配置\n     */")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorizationServerEndpointsConfigurer")]),s._v(" endpoints"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        endpoints"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticationManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authenticationManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("userDetailsService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientDetailsServiceConfigurer")]),s._v(" clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("inMemory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("withClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置client_id")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("passwordEncoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin123456"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置client_secret")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("accessTokenValiditySeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置访问token的有效期")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("refreshTokenValiditySeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("864000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置刷新token的有效期")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("redirectUris")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.baidu.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置redirect_uri，用于授权成功后跳转")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scopes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"all"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置申请的权限范围")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authorizedGrantTypes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"authorization_code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置grant_type，表示授权类型")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])])]),s._v(" "),n("ul",[n("li",[s._v("添加"),n("code",[s._v("资源服务器配置")]),s._v("，使用"),n("code",[s._v("@EnableResourceServer")]),s._v("注解开启")])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("模拟资源服务器配置")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableResourceServer")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceServerConfig")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceServerConfigurerAdapter")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSecurity")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authorizeRequests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("anyRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticated")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("and")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestMatchers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("antMatchers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/**"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置需要保护的资源路径")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("ul",[n("li",[s._v("添加"),n("code",[s._v("SpringSecurity配置")]),s._v("，允许认证相关路径的访问及表单登录")])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("过滤不需认证的路径")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableWebSecurity")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityConfig")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSecurityConfigurerAdapter")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationManager")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticationManagerBean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticationManagerBean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSecurity")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("csrf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("disable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authorizeRequests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("antMatchers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/oauth/**"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/login/**"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/logout/**"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("permitAll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("anyRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticated")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("and")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("formLogin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("permitAll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])])]),s._v(" "),n("ul",[n("li",[s._v("测试接口，返回认证信息")])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("测试接口")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserController")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/getCurrentUser"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCurrentUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" authentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" authentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPrincipal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])]),s._v(" "),n("h1",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("h2",{attrs:{id:"授权码模式大致流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权码模式大致流程"}},[s._v("#")]),s._v(" 授权码模式大致流程")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("启动auth2-server服务")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://localhost:9401/oauth/authorize?response_type=code&client_id=admin&redirect_uri=http://www.baidu.com&scope=all&state=normal",target:"_blank",rel:"noopener noreferrer"}},[s._v("访问地址"),n("OutboundLink")],1),s._v("：模拟用户登陆时候，选择三方登陆，统一授权，返回的url中，包含了认证服务器给的授权码")]),s._v(" "),n("p",[s._v("https://www.baidu.com/?code=11KUJe&state=normal`")])]),s._v(" "),n("li",[n("p",[s._v("携带授权码，向认证服务器申请令牌，认证服务器返回令牌")])]),s._v(" "),n("li",[n("p",[s._v("携带令牌访问资源，用户使用三方账号登陆成功")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);