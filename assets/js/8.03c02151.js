(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{469:function(s,t,a){s.exports=a.p+"assets/img/image-20200408194716912.934ff829.png"},593:function(s,t,a){s.exports=a.p+"assets/img/image-20200509121254425.f304bf37.png"},594:function(s,t,a){s.exports=a.p+"assets/img/image-20200509151424280.b618d57f.png"},595:function(s,t,a){s.exports=a.p+"assets/img/image-20200509152947714.967c05ad.png"},596:function(s,t,a){s.exports=a.p+"assets/img/image-20200509153731363.425c1683.png"},597:function(s,t,a){s.exports=a.p+"assets/img/image-20200509191917069.6d0c1442.png"},598:function(s,t,a){s.exports=a.p+"assets/img/image-20200620175731338.57a3e689.png"},599:function(s,t,a){s.exports=a.p+"assets/img/image-20200510103945494.514ae73e.png"},600:function(s,t,a){s.exports=a.p+"assets/img/image-20200510113311209.c08c2b86.png"},601:function(s,t,a){s.exports=a.p+"assets/img/image-20200623092808049.1414c953.png"},602:function(s,t,a){s.exports=a.p+"assets/img/image-20200516112704764.dfcca666.png"},603:function(s,t,a){s.exports=a.p+"assets/img/image-20200516102419998.7a6e16c2.png"},719:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("本章主要学习K8s组件之一service，包含介绍，五种类型的service，ingress使用。根据"),n("a",{attrs:{href:"https://www.bilibili.com/video/BV1cK4y1L7Am?p=1",target:"_blank",rel:"noopener noreferrer"}},[s._v("哔哩哔哩黑马视频"),n("OutboundLink")],1),s._v("学习，学习来源于搬迁，部分文档有根据自己学习进行修改和补充，"),n("a",{attrs:{href:"https://www.orchome.com/1786",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档学习资源"),n("OutboundLink")],1)])]),s._v(" "),n("h1",{attrs:{id:"第七章-service详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第七章-service详解"}},[s._v("#")]),s._v(" 第七章 Service详解")]),s._v(" "),n("p",[s._v("本章节主要介绍kubernetes的流量负载组件：Service和Ingress。")]),s._v(" "),n("h2",{attrs:{id:"service介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service介绍"}},[s._v("#")]),s._v(" Service介绍")]),s._v(" "),n("p",[s._v("​    在kubernetes中，pod是应用程序的载体，我们可以通过pod的ip来访问应用程序，但是pod的ip地址不是固定的，这也就意味着不方便直接采用pod的ip对服务进行访问。")]),s._v(" "),n("p",[s._v("​    为了解决这个问题，kubernetes提供了Service资源，Service会对提供同一个服务的多个pod进行聚合，并且提供一个统一的入口地址。通过访问Service的入口地址就能访问到后面的pod服务。")]),s._v(" "),n("img",{staticStyle:{zoom:"100%",border:"1px solid"},attrs:{src:a(469)}}),s._v(" "),n("p",[s._v("​    Service在很多情况下只是一个概念，真正起作用的其实是kube-proxy服务进程，每个Node节点上都运行着一个kube-proxy服务进程。当创建Service的时候会通过api-server向etcd写入创建的service的信息，而kube-proxy会基于监听的机制发现这种Service的变动，然后"),n("strong",[s._v("它会将最新的Service信息转换成对应的访问规则")]),s._v("。")]),s._v(" "),n("img",{staticStyle:{border:"1px solid"},attrs:{src:a(593)}}),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10.97.97.97:80 是service提供的访问入口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当访问这个入口的时候，可以发现后面有三个pod的服务在等待调用，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kube-proxy会基于rr（轮询）的策略，将请求分发到其中一个pod上去")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个规则会同时在集群内的所有节点上都生成，所以在任何一个节点上访问都可以。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@node1 ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -Ln")]),s._v("\nIP Virtual Server version 1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size=4096"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProt LocalAddress:Port Scheduler Flags\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80 rr\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80               Masq    1      0          0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("kube-proxy目前支持三种工作模式:")]),s._v(" "),n("p",[n("strong",[s._v("userspace 模式")])]),s._v(" "),n("p",[s._v("​    userspace模式下，kube-proxy会为每一个Service创建一个监听端口，发向Cluster IP的请求被Iptables规则重定向到kube-proxy监听的端口上，kube-proxy根据LB算法选择一个提供服务的Pod并和其建立链接，以将请求转发到Pod上。\n​    该模式下，kube-proxy充当了一个四层负责均衡器的角色。由于kube-proxy运行在userspace中，在进行转发处理时会增加内核和用户空间之间的数据拷贝，虽然比较稳定，但是效率比较低。")]),s._v(" "),n("img",{staticStyle:{border:"1px solid",zoom:"57%"},attrs:{src:a(594)}}),s._v(" "),n("p",[n("strong",[s._v("iptables 模式")])]),s._v(" "),n("p",[s._v("​    iptables模式下，kube-proxy为service后端的每个Pod创建对应的iptables规则，直接将发向Cluster IP的请求重定向到一个Pod IP。\n​    该模式下kube-proxy不承担四层负责均衡器的角色，只负责创建iptables规则。该模式的优点是较userspace模式效率更高，但不能提供灵活的LB策略，当后端Pod不可用时也无法进行重试。")]),s._v(" "),n("img",{staticStyle:{zoom:"57%"},attrs:{src:a(595)}}),s._v(" "),n("p",[n("strong",[s._v("ipvs 模式")])]),s._v(" "),n("p",[s._v("​    ipvs模式和iptables类似，kube-proxy监控Pod的变化并创建相应的ipvs规则。ipvs相对iptables转发效率更高。除此以外，ipvs支持更多的LB算法。")]),s._v(" "),n("img",{staticStyle:{zoom:"57%"},attrs:{src:a(596)}}),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此模式必须安装ipvs内核模块，否则会降级为iptables")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启ipvs")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit cm kube-proxy -n kube-system")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搜索mode，修改值为ipvs")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete pod -l k8s-app=kube-proxy -n kube-system")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@node1 ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -Ln")]),s._v("\nIP Virtual Server version 1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size=4096"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProt LocalAddress:Port Scheduler Flags\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80 rr\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80               Masq    1      0          0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h2",{attrs:{id:"service类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service类型"}},[s._v("#")]),s._v(" Service类型")]),s._v(" "),n("p",[s._v("Service的资源清单文件：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源类型")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 元数据")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源名称")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命名空间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 描述")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标签选择器，用于确定当前service代理哪些pod")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Service类型，指定service的访问方式")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟服务的ip地址")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sessionAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session亲和性，支持ClientIP、None两个选项")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口信息")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3017")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service端口")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5003")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod端口")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31122")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机端口")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("ul",[n("li",[s._v("ClusterIP：默认值，它是Kubernetes系统自动分配的虚拟IP，只能在集群内部访问")]),s._v(" "),n("li",[s._v("NodePort：将Service通过指定的Node上的端口暴露给外部，通过此方法，就可以在集群外部访问服务")]),s._v(" "),n("li",[s._v("LoadBalancer：使用外接负载均衡器完成到服务的负载分发，注意此模式需要外部云环境支持")]),s._v(" "),n("li",[s._v("ExternalName： 把集群外部的服务引入集群内部，直接使用")])]),s._v(" "),n("h2",{attrs:{id:"service使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service使用"}},[s._v("#")]),s._v(" Service使用")]),s._v(" "),n("h3",{attrs:{id:"实验环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实验环境准备"}},[s._v("#")]),s._v(" 实验环境准备")]),s._v(" "),n("p",[s._v("在使用service之前，首先利用Deployment创建出3个pod，注意要为pod设置"),n("code",[s._v("app=nginx-pod")]),s._v("的标签")]),s._v(" "),n("p",[s._v("创建deployment.yaml，内容如下：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment      \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deployment\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f deployment.yaml")]),s._v("\ndeployment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看pod详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n dev -o wide --show-labels")]),s._v("\nNAME                             READY   STATUS     IP            NODE     LABELS\npc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("8p84h   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running    10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40   node1    app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\npc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vx8vx   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running    10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33   node2    app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\npc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("66cb59b984"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("wnncx   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running    10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39   node1    app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为了方便后面的测试，修改下三台nginx的index.html页面（三台修改的IP地址不一致）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "10.244.1.40" > /usr/share/nginx/html/index.html')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改完毕之后，访问测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.1.40")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.2.33")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.1.39")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"clusterip类型的service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#clusterip类型的service"}},[s._v("#")]),s._v(" ClusterIP类型的Service")]),s._v(" "),n("p",[s._v("创建service-clusterip.yaml文件")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterip\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.97.97.97 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service的ip地址，如果不写，默认会生成一个")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Service端口       ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod端口")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f service-clusterip.yaml")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("clusterip created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n dev -o wide")]),s._v("\nNAME                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("        CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP    EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE   SELECTOR\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("clusterip   ClusterIP   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97   <none>        80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP    13s   app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service的详细信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里有一个Endpoints列表，里面就是当前service可以负载到的服务入口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe svc service-clusterip -n dev")]),s._v("\nName:              service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("clusterip\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Type")]),s._v(":              ClusterIP\nIP:                10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97\nPort:              <unset>  80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP\nTargetPort:        80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP\nEndpoints:         10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80\nSession Affinity:  None\nEvents:            <none>\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看ipvs的映射规则")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -Ln")]),s._v("\nTCP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80 rr\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80               Masq    1      0          0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问10.97.97.97:80观察效果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.97.97.97:80")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("p",[n("strong",[s._v("Endpoint")])]),s._v(" "),n("p",[s._v("​    Endpoint是kubernetes中的一个资源对象，存储在etcd中，用来记录一个service对应的所有pod的访问地址，它是根据service配置文件中selector描述产生的。")]),s._v(" "),n("p",[s._v("​    一个Service由一组Pod组成，这些Pod通过Endpoints暴露出来，"),n("strong",[s._v("Endpoints是实现实际服务的端点集合")]),s._v("。换句话说，service和pod之间的联系是通过endpoints实现的。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(597),alt:"image-20200509191917069"}})]),s._v(" "),n("p",[n("strong",[s._v("负载分发策略")])]),s._v(" "),n("p",[s._v("对Service的访问被分发到了后端的Pod上去，目前kubernetes提供了两种负载分发策略：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("如果不定义，默认使用kube-proxy的策略，比如随机、轮询")])]),s._v(" "),n("li",[n("p",[s._v("基于客户端地址的会话保持模式，即来自同一个客户端发起的所有请求都会转发到固定的一个Pod上")]),s._v(" "),n("p",[s._v("此模式可以使在spec中添加"),n("code",[s._v("sessionAffinity:ClientIP")]),s._v("选项")])])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看ipvs的映射规则【rr 轮询】")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -Ln")]),s._v("\nTCP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80 rr\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80               Masq    1      0          0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环访问测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# while true;do curl 10.97.97.97:80; sleep 5; done;")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改分发策略----sessionAffinity:ClientIP")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看ipvs规则【persistent 代表持久】")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -Ln")]),s._v("\nTCP  10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80 rr persistent 10800\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80               Masq    1      0          0\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("> 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80               Masq    1      0          0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环访问测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# while true;do curl 10.97.97.97; sleep 5; done;")]),s._v("\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete -f service-clusterip.yaml")]),s._v("\nservice "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service-clusterip"')]),s._v(" deleted\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("h3",{attrs:{id:"headliness类型的service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#headliness类型的service"}},[s._v("#")]),s._v(" HeadLiness类型的Service")]),s._v(" "),n("p",[s._v("​    在某些场景中，开发人员可能不想使用Service提供的负载均衡功能，而希望自己来控制负载均衡策略，针对这种情况，kubernetes提供了HeadLiness  Service，这类Service不会分配Cluster IP，如果想要访问service，只能通过service的域名进行查询。")]),s._v(" "),n("p",[s._v("创建service-headliness.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headliness\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将clusterIP设置为None，即可创建headliness Service")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("    \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f service-headliness.yaml")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取service， 发现CLUSTER-IP未分配")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc service-headliness -n dev -o wide")]),s._v("\nNAME                 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("        CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE   SELECTOR\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness   ClusterIP   None         <none>        80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP    11s   app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe svc service-headliness  -n dev")]),s._v("\nName:              service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Type")]),s._v(":              ClusterIP\nIP:                None\nPort:              <unset>  80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP\nTargetPort:        80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP\nEndpoints:         10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33:80\nSession Affinity:  None\nEvents:            <none>\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看域名的解析情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/resolv.conf")]),s._v("\nnameserver 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("10\nsearch dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local\n\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dig @10.96.0.10 service-headliness.dev.svc.cluster.local")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 30 IN A 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("40\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 30 IN A 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("39\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headliness"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 30 IN A 10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("33\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("h3",{attrs:{id:"nodeport类型的service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodeport类型的service"}},[s._v("#")]),s._v(" NodePort类型的Service")]),s._v(" "),n("p",[s._v("​    在之前的样例中，创建的Service的ip地址只有集群内部才可以访问，如果希望将Service暴露给集群外部使用，那么就要使用到另外一种类型的Service，称为NodePort类型。NodePort的工作原理其实就是"),n("strong",[s._v("将service的端口映射到Node的一个端口上")]),s._v("，然后就可以通过"),n("code",[s._v("NodeIp:NodePort")]),s._v("来访问service了。")]),s._v(" "),n("img",{staticStyle:{border:"1px solid"},attrs:{src:a(598)}}),s._v(" "),n("p",[s._v("创建service-nodeport.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nodeport\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service类型")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30002")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f service-nodeport.yaml")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodeport created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n dev -o wide")]),s._v("\nNAME               "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("       CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP      EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       SELECTOR\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodeport   NodePort   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("105"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("191   <none>        80:30002"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP  app=nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接下来可以通过电脑主机的浏览器去访问集群中任意一个nodeip的30002端口，即可访问到pod")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"loadbalancer类型的service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#loadbalancer类型的service"}},[s._v("#")]),s._v(" LoadBalancer类型的Service")]),s._v(" "),n("p",[s._v("​    LoadBalancer和NodePort很相似，目的都是向外部暴露一个端口，区别在于LoadBalancer会在集群的外部再来做一个负载均衡设备，而这个设备需要外部环境支持的，外部服务发送到这个设备上的请求，会被设备负载之后转发到集群中。")]),s._v(" "),n("img",{staticStyle:{border:"1px solid"},attrs:{src:a(599)}}),s._v(" "),n("h3",{attrs:{id:"externalname类型的service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#externalname类型的service"}},[s._v("#")]),s._v(" ExternalName类型的Service")]),s._v(" "),n("p",[s._v("​     ExternalName类型的Service用于引入集群外部的服务，它通过"),n("code",[s._v("externalName")]),s._v("属性指定外部一个服务的地址，然后在集群内部访问此service就可以访问到外部的服务了。")]),s._v(" "),n("img",{staticStyle:{border:"1px solid"},attrs:{src:a(600)}}),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("externalname\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ExternalName "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service类型")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("externalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www.baidu.com  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#改成ip地址也可以")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  create -f service-externalname.yaml")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("externalname created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名解析")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dig @10.96.0.10 service-externalname.dev.svc.cluster.local")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("externalname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 30 IN CNAME www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nwww"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("          30      IN      CNAME   www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shifen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nwww"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shifen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("       30      IN      A       39"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("156"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("66"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("18\nwww"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shifen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("       30      IN      A       39"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("156"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("66"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("14\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"ingress介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ingress介绍"}},[s._v("#")]),s._v(" Ingress介绍")]),s._v(" "),n("p",[s._v("​     在前面课程中已经提到，Service对集群之外暴露服务的主要方式有两种：NotePort和LoadBalancer，但是这两种方式，都有一定的缺点：")]),s._v(" "),n("ul",[n("li",[s._v("NodePort方式的缺点是会占用很多集群机器的端口，那么当集群服务变多的时候，这个缺点就愈发明显")]),s._v(" "),n("li",[s._v("LB方式的缺点是每个service需要一个LB，浪费、麻烦，并且需要kubernetes之外设备的支持")])]),s._v(" "),n("p",[s._v("​    基于这种现状，kubernetes提供了Ingress资源对象，Ingress只需要一个NodePort或者一个LB就可以满足暴露多个Service的需求。工作机制大致如下图表示：")]),s._v(" "),n("img",{staticStyle:{border:"1px solid"},attrs:{src:a(601)}}),s._v(" "),n("p",[s._v("​    实际上，Ingress相当于一个7层的负载均衡器，是kubernetes对反向代理的一个抽象，它的工作原理类似于Nginx，可以理解成在"),n("strong",[s._v("Ingress里建立诸多映射规则，Ingress Controller通过监听这些配置规则并转化成Nginx的反向代理配置 , 然后对外部提供服务")]),s._v("。在这里有两个核心概念：")]),s._v(" "),n("ul",[n("li",[s._v("ingress：kubernetes中的一个对象，作用是定义请求如何转发到service的规则")]),s._v(" "),n("li",[s._v("ingress controller：具体实现反向代理及负载均衡的程序，对ingress定义的规则进行解析，根据配置的规则来实现请求转发，实现方式有很多，比如Nginx, Contour, Haproxy等等")])]),s._v(" "),n("p",[s._v("Ingress（以Nginx为例）的工作原理如下：")]),s._v(" "),n("ol",[n("li",[s._v("用户编写Ingress规则，说明哪个域名对应kubernetes集群中的哪个Service")]),s._v(" "),n("li",[s._v("Ingress控制器动态感知Ingress服务规则的变化，然后生成一段对应的Nginx反向代理配置")]),s._v(" "),n("li",[s._v("Ingress控制器会将生成的Nginx配置写入到一个运行着的Nginx服务中，并动态更新")]),s._v(" "),n("li",[s._v("到此为止，其实真正在工作的就是一个Nginx了，内部配置了用户定义的请求转发规则")])]),s._v(" "),n("img",{staticStyle:{border:"1px solid",zoom:"100%"},attrs:{src:a(602)}}),s._v(" "),n("h2",{attrs:{id:"ingress使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ingress使用"}},[s._v("#")]),s._v(" Ingress使用")]),s._v(" "),n("h3",{attrs:{id:"环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),n("p",[n("strong",[s._v("搭建ingress环境")])]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建文件夹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir ingress-controller")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ingress-controller/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取ingress-nginx，本次案例使用的是0.30版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ingress-controller]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ingress-controller]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改mandatory.yaml文件中的仓库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为quay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ingress-nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ingress-controller]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f ./")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看ingress-nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ingress-controller]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n ingress-nginx")]),s._v("\nNAME                                           READY   STATUS    RESTARTS   AGE\npod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fbf967dd5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("4qpbp   1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("1     Running   0          12h\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ingress-controller]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n ingress-nginx")]),s._v("\nNAME            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("       CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP     EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      AGE\ningress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx   NodePort   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("98"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("75"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("163   <none>        80:32240"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("443:31335"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP   11h\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[n("strong",[s._v("准备service和pod")])]),s._v(" "),n("p",[s._v("为了后面的实验比较方便，创建如下图所示的模型")]),s._v(" "),n("img",{staticStyle:{zoom:"80%",border:"1px solid"},attrs:{src:a(603)}}),s._v(" "),n("p",[s._v("创建tomcat-nginx.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deployment\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deployment\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8.5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("slim\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f tomcat-nginx.yaml")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n dev")]),s._v("\nNAME             "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("TYPE")]),s._v("        CLUSTER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   EXTERNAL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\nnginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service    ClusterIP   None         <none>        80"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP     48s\ntomcat"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service   ClusterIP   None         <none>        8080"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TCP   48s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"http代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http代理"}},[s._v("#")]),s._v(" Http代理")]),s._v(" "),n("p",[s._v("创建ingress-http.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.itheima.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat.itheima.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f ingress-http.yaml")]),s._v("\ningress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("extensions"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ingress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ing ingress-http -n dev")]),s._v("\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\ningress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http   nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com             80      22s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe ing ingress-http  -n dev")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nRules:\nHost                Path  Backends\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\nnginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service:80 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("112:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("94:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("95:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("111:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接下来,在本地电脑上配置host文件,解析上面的两个域名到192.168.109.100(master)上")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后,就可以分别访问tomcat.itheima.com:32240  和  nginx.itheima.com:32240 查看效果了")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"https代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#https代理"}},[s._v("#")]),s._v(" Https代理")]),s._v(" "),n("p",[s._v("创建证书")]),s._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成证书")]),s._v("\nopenssl req "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x509 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha256 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days 365 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("newkey rsa:2048 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyout tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("out tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("subj "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建密钥")]),s._v("\nkubectl create secret tls tls"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("secret "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("key tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("创建ingress-https.yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nginx.itheima.com\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" tomcat.itheima.com\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("secret "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定秘钥")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.itheima.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat.itheima.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f ingress-https.yaml")]),s._v("\ningress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("extensions"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ingress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ing ingress-https -n dev")]),s._v("\nNAME            HOSTS                                  ADDRESS         PORTS     AGE\ningress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https   nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com   10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("104"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("184"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("38   80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 443   2m42s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看详情")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe ing ingress-https -n dev")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nTLS:\n  tls"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("secret terminates nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nRules:\nHost              Path Backends\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\nnginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service:80 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("97:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("98:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("119:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  tomcat"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("99:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("117:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("120:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面可以通过浏览器访问https://nginx.itheima.com:31335 和 https://tomcat.itheima.com:31335来查看了")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);